!function(){"use strict";const e=1e4,t=50,o=3e4,n=16,s=100,i=new Map,l=new WeakSet,r=new Map,a=new WeakSet,c=new Map,d=new WeakSet,f=new Map,u=new WeakSet,x=new Map,h=new WeakSet,m=new Map,y=new WeakSet,p=new Map,g=new WeakSet,S=new Map,b=new WeakSet,T=new Map,L=new Map,P=new WeakSet,C=new WeakMap,v=new WeakMap,M=new Map,N=new WeakSet,w=new WeakSet,E=new Map,$=new WeakSet;let O,D,q,z,I,U,B=0,F=new Set,A=new Set,_=new Set,k=new Set,R=new Set;const V=navigator.platform.toLowerCase().includes("mac")||navigator.userAgent.toLowerCase().includes("mac")||navigator.platform.toLowerCase().includes("darwin")||/macintosh|mac os x/i.test(navigator.userAgent),W=V?75:t,H=V?250:150,j=V?25:n,G={pnlContainers:['div[style*="flex: 1 0 140px"]','div[style*="flex:1 0 140px"]','div[style*="flex: 1"]',".truncate-parent"],sizeContainers:['div[style*="flex: 1 0 100px"]','div[style*="flex:1 0 100px"]','div[style*="flex:1"]','div[style*="flex: 1 0 100"]','div[style*="flex:1 0 100"]','[style*="100px"][class*="text-"]','[class*="text-Sell"][style*="flex"]','[class*="text-Buy"][style*="flex"]','div[style*="width: 100px"][style*="flex"]','.text-Buy[style*="100px"]','.text-Sell[style*="100px"]','[style*="flex: 1"][class*="typography-caption2"]'],mobilePnlContainers:["#POSITIONS .py-\\[16px\\]",'#POSITIONS div[class*="py-[16px]"]',".py-\\[16px\\]",'[class*="py-[16px]"]'],mobilePnlElements:[".flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis.text-TextSell",".flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis.text-TextBuy",'.text-TextSell[class*="t-body2"]','.text-TextBuy[class*="t-body2"]','[class*="text-TextSell"][class*="t-body2"]','[class*="text-TextBuy"][class*="t-body2"]',".t-body2.text-TextSell",".t-body2.text-TextBuy",".text-TextSell.t-body2",".text-TextBuy.t-body2",'div.text-TextSell[class*="t-body2"]','div.text-TextBuy[class*="t-body2"]','[class="flex text-PrimaryText t-body2 whitespace-nowrap overflow-hidden text-ellipsis text-TextSell"]','[class="flex text-PrimaryText t-body2 whitespace-nowrap overflow-hidden text-ellipsis text-TextBuy"]'],mobileSizeContainers:["#POSITIONS .grid.grid-cols-3.gap-\\[8px\\].mb-\\[8px\\]",'#POSITIONS div[class*="grid-cols-3"]',".grid.grid-cols-3",'[class*="grid-cols-3"]'],mobileSizeElements:[".flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis:not(.text-TextSell):not(.text-TextBuy)","#POSITIONS .flex.flex-col.items-left .flex.text-PrimaryText.t-body2",".grid-cols-3 .flex.flex-col.items-left .flex.text-PrimaryText.t-body2",".flex.flex-col.items-left .t-body2:not(.text-TextSell):not(.text-TextBuy)",".grid-cols-3 .flex.text-PrimaryText.t-body2:not(.text-TextSell):not(.text-TextBuy)","#POSITIONS .grid .flex.text-PrimaryText.t-body2:not(.text-TextSell):not(.text-TextBuy)","#POSITIONS .grid.grid-cols-3 .flex.flex-col.items-left .flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis",".grid.grid-cols-3.gap-\\[8px\\].mb-\\[8px\\] .flex.flex-col.items-left .flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis"],mobileMarginElements:["#POSITIONS .grid.grid-cols-3 .flex.flex-col:not(.items-left):not(.items-end) .flex.text-PrimaryText.t-body2",".grid.grid-cols-3 .flex.flex-col:not(.items-left):not(.items-end) .t-body2","#POSITIONS .grid-cols-3 > div:nth-child(2) .t-body2",".grid-cols-3 .flex.flex-col:not([class*='items-']) .text-PrimaryText.t-body2"],roiElements:[".t-caption1.text-TextSell",".t-caption1.text-TextBuy",'[class*="t-caption1"][class*="text-TextSell"]','[class*="t-caption1"][class*="text-TextBuy"]',".text-TextSell.t-caption1",".text-TextBuy.t-caption1",'[class*="typography-caption"][class*="text-Sell"]','[class*="typography-caption"][class*="text-Buy"]',".typography-caption2.text-Sell",".typography-caption2.text-Buy"],shareCardContainers:["#share-position-poster","#web-share-sdk-share-poster .PosterImage",'div[id="share-position-poster"]'],shareCardPnlParents:["#share-position-poster .mb-\\[16px\\].text-Sell","#share-position-poster .mb-\\[16px\\].text-Buy",'#share-position-poster div[class*="mb-[16px]"][class*="text-Sell"]','#share-position-poster div[class*="mb-[16px]"][class*="text-Buy"]'],shareCardPnlElements:["#share-position-poster .t-headline1.\\!leading-none","#share-position-poster .mb-\\[16px\\] > .t-headline1","#share-position-poster .text-Sell .t-headline1","#share-position-poster .text-Buy .t-headline1"],shareCardRoiElements:["#share-position-poster .mb-\\[16px\\] > .typography-subtitle4","#share-position-poster .text-Sell .typography-subtitle4","#share-position-poster .text-Buy .typography-subtitle4"],positionCards:["#POSITIONS .py-\\[16px\\]",'#POSITIONS div[class*="py-[16px]"]',".py-\\[16px\\]",'[class*="py-[16px]"]','[class*="position-card"]',"[data-position-card]"],containers:[".fixed-size-list",".list-container",'[id*="position"]',"#POSITIONS",'[class*="position"]','div[style*="overflow: auto"]','div[style*="overflow-x: auto"]','div[style*="overflow:auto"]','div[style*="overflow-x:auto"]'],truncateElements:[".truncate",".text-truncate",'[class*="truncate"]']};function K(e,t="pnl"){const o=Math.abs(e),n=Math.floor(o),s={pnl:31,margin:37,size:41},i=31===s[t]?53:37===s[t]?59:67,l=17*(n*(s[t]||31)^n>>5)%100,r=(Math.floor(n/100)*i^255&n)+n%23,a=(13*r^r>>3)%100,c=100*Math.floor(n/100)+l,d=a.toString().padStart(2,"0");return`${c.toLocaleString("en-US")}.${d}`}function J(t,o){if(!o)return!0;const n=o*e,s=Math.abs(t);return s<=.2*Math.abs(n)&&s>.01}function Q(t,o){if(!o)return!0;const n=o*e,s=Math.abs(t);return s<=.2*Math.abs(n)&&s>.01}function X(e){try{if(!e||!document.body.contains(e))return!1;const t=e.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth,s=V?10:5;return t.top>=-s&&t.left>=-s&&t.bottom<=o+s&&t.right<=n+s&&t.width>0&&t.height>0}catch(e){return console.warn("PNL Modifier: Error checking viewport:",e),!1}}function Y(e,t){for(const o of t)try{const t=e.querySelector(o);if(t)return t}catch(e){continue}return null}function Z(e){try{const t=e.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*%/);if(t&&t[1]){const e=parseFloat(t[1].replace(/,/g,""));if(!isNaN(e))return e/100}return null}catch(e){return console.warn("PNL Modifier: Error extracting ROI:",e),null}}function ee(e){try{if(!e||!document.body.contains(e))return;let t=null;G.roiElements.forEach((o=>{if(!t){const n=e.querySelector(o);n&&n.textContent.includes("%")&&(t=n)}}));let o=null;G.mobileMarginElements.forEach((t=>{if(!o){const n=e.querySelector(t);if(n){const e=n.closest(".flex.flex-col"),t=e?.querySelector('[class*="t-caption1"]');t&&t.textContent.includes("Margin")&&(o=n)}}}));let n=null;G.mobilePnlElements.forEach((t=>{if(!n){e.querySelectorAll(t).forEach((e=>{e.closest(".grid-cols-3")||(n=e)}))}}));let s=null;if(G.mobileSizeElements.forEach((t=>{if(!s){const o=e.querySelector(t);if(o){const e=o.closest(".flex.flex-col.items-left"),t=e?.querySelector('[class*="t-caption1"]');t&&t.textContent.includes("Size")&&(s=o)}}})),t&&o&&n){const i={card:e,roi:t,margin:o,pnl:n,size:s};L.set(e,i),C.set(n,e),v.set(t,e),function(e,t){if(P.has(e))return;P.add(e);const o=new MutationObserver((o=>{o.forEach((o=>{if("characterData"===o.type||"childList"===o.type)try{const o=Z(e);if(null!==o){const n=T.get(e);(void 0===n||Math.abs(o-n)>1e-4)&&(T.set(e,o),e.dataset.originalRoi=o.toString(),te(t))}}catch(e){console.warn("PNL Modifier: Error in ROI observer:",e)}}))}));o.observe(e,{characterData:!0,childList:!0,subtree:!0}),e._roiObserver=o;const n=Z(e);null!==n&&(T.set(e,n),e.dataset.originalRoi=n.toString())}(t,e),console.log("PNL Modifier: Linked position card:",{hasROI:!!t,hasMargin:!!o,hasPNL:!!n,hasSize:!!s,roiText:t?.textContent,marginText:o?.textContent})}}catch(e){console.warn("PNL Modifier: Error linking position card:",e)}}function te(t){try{const o=L.get(t);if(!o)return;const{roi:n,margin:s,pnl:a}=o;if(!n||!s||!a)return;let c=T.get(n);if(void 0===c||isNaN(c)){if(c=Z(n),null===c)return;T.set(n,c),n.dataset.originalRoi=c.toString()}let d=p.get(s);if(void 0===d)if(s.dataset.originalMargin)d=parseFloat(s.dataset.originalMargin),p.set(s,d);else{let t="";t=s.firstChild&&3===s.firstChild.nodeType?s.firstChild.nodeValue.trim():s.textContent.trim();const o=t.match(/^([+-]?[\d,]+\.?\d*)$/);if(!o||!o[1])return void console.error("PNL Modifier: Cannot extract margin - cache miss and parse failed");const n=parseFloat(o[1].replace(/,/g,""));n>1e4?(d=n/e,console.warn("PNL Modifier: Margin cache miss - dividing displayed value (may be inaccurate due to randomization)")):d=n,p.set(s,d),s.dataset.originalMargin=d.toString()}if(isNaN(d))return void console.error("PNL Modifier: Invalid original margin value");const f=function(e,t){return e*t}(c,d),u=f*e,x=u>0?"+":u<0?"-":"",h=`${x}${K(Math.abs(u),"pnl")}`;if(a.textContent!==h){const e=a._mobilePnlProtectionObserver;e&&e.disconnect(),a._updatingFromRoi=!0,a.textContent=h,f<0&&!h.startsWith("-")&&(console.error("PNL Modifier: CRITICAL - Negative PNL missing minus sign!",{calculatedPnl:f,formattedPnl:h,sign:x}),a.textContent=`-${h}`),i.set(a,f),a.dataset.originalPnl=f.toString(),l.add(a),r.set(a,Date.now()),a._updatingFromRoi=!1,Promise.resolve().then((()=>{if(e)try{e.observe(a,{characterData:!0,childList:!0,subtree:!0})}catch(e){}})),console.log("PNL Modifier: Updated PNL from ROI (optimized):",{roi:`${(100*c).toFixed(2)}%`,margin:d.toFixed(2),calculatedPnl:f.toFixed(2),displayedPnl:h})}}catch(e){console.warn("PNL Modifier: Error updating PNL from ROI:",e)}}function oe(t){try{if(!document.body.contains(t)||null===t.offsetParent)return;const o=Y(t,G.truncateElements);if(!o)return;const n=o.textContent.trim(),s=n.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(s&&s[1]){let c;i.has(t)?c=i.get(t):(c=parseFloat(s[1].replace(/,/g,"")),i.set(t,c),o.dataset.originalText=n,o.dataset.originalPnl=c.toString(),t.dataset.originalPnl=c.toString());const d=c*e,f=`${d>0?"+":d<0?"-":""}${K(Math.abs(d),"pnl")} USDT`;o.textContent!==f&&(o.textContent=f,l.add(o),a.add(o),r.set(t,Date.now()),ae(o,f))}}catch(e){console.warn("PNL Modifier: Error processing PNL element:",e)}}function ne(t){try{if(!document.body.contains(t)||null===t.offsetParent)return;const o=C.get(t);if(o)return void te(o);const n=t.textContent.trim(),s=n.match(/^([+-]?[\d,]+\.?\d*)$/);if(s&&s[1]){let o;i.has(t)?o=i.get(t):(o=parseFloat(s[1].replace(/,/g,"")),i.set(t,o),t.dataset.originalText=n,t.dataset.originalPnl=o.toString(),V&&console.log("PNL Modifier (macOS): Found mobile PNL element (no ROI):",{text:n,originalValue:o,classes:t.className,hasTextSell:t.classList.contains("text-TextSell"),hasTextBuy:t.classList.contains("text-TextBuy")}));const c=o*e,d=`${c>0?"+":c<0?"-":""}${K(Math.abs(c),"pnl")}`;t.textContent!==d&&(t.textContent=d,l.add(t),a.add(t),r.set(t,Date.now()),ce(t,d),V&&console.log("PNL Modifier (macOS): Updated mobile PNL element (no ROI):",{original:n,modified:d,multiplier:e}))}}catch(e){console.warn("PNL Modifier: Error processing mobile PNL element:",e)}}function se(t){try{if(!document.body.contains(t)||null===t.offsetParent)return;const o=t.textContent.trim(),n=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(n&&n[1]){let s;x.has(t)?s=x.get(t):(s=parseFloat(n[1].replace(/,/g,"")),x.set(t,s),t.dataset.originalText=o,t.dataset.originalSize=s.toString(),console.log("PNL Modifier: Found mobile size element:",{text:o,originalValue:s,classes:t.className,isNegative:s<0}));const i=s*e,l=`${i<0?"-":""}${K(Math.abs(i),"size")}`;t.textContent!==l&&(t.textContent=l,h.add(t),y.add(t),m.set(t,Date.now()),de(t,l),console.log("PNL Modifier: Updated mobile size element:",{original:o,modified:l,wasNegative:s<0}))}}catch(e){console.warn("PNL Modifier: Error processing mobile size element:",e)}}function ie(t){try{if(!document.body.contains(t)||null===t.offsetParent)return;let o="";o=t.firstChild&&3===t.firstChild.nodeType?t.firstChild.nodeValue.trim():t.textContent.trim();const n=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(n&&n[1]){let o;if(p.has(t))o=p.get(t);else{const e=parseFloat(n[1].replace(/,/g,""));if(isNaN(e)||0===e)return;const s=t.closest(".flex.flex-col");if(!s)return;const i=s.querySelector('[class*="t-caption1"]');if(!i||!i.textContent.includes("Margin"))return;o=e,p.set(t,o),t.dataset.originalText=n[1],t.dataset.originalMargin=o.toString()}const s=o*e,i=`${s<0?"-":""}${K(Math.abs(s),"margin")}`;if(t.firstChild&&3===t.firstChild.nodeType)t.firstChild.nodeValue.trim()!==i&&(t.firstChild.nodeValue=i,g.add(t),b.add(t),S.set(t,Date.now()),fe(t,i));else if(t.textContent.trim()!==i){const e=t.querySelector("svg");t.textContent=i,e&&t.appendChild(e),g.add(t),b.add(t),S.set(t,Date.now()),fe(t,i)}}}catch(e){console.warn("PNL Modifier: Error processing mobile margin element:",e)}}function le(t){try{if(!document.body.contains(t)||null===t.offsetParent)return;let o=t.textContent.trim();if(!o.includes("USDT")&&t.querySelector){const e=t.querySelector('[class*="text-"]')||t.querySelector('*[text*="USDT"]')||t.querySelector("span, div");e&&(o=e.textContent.trim())}const n=o.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(n&&n[1]){let s;c.has(t)?s=c.get(t):(s=parseFloat(n[1].replace(/,/g,"")),c.set(t,s),t.dataset.originalText=o,t.dataset.originalSize=s.toString());const i=s*e,l=t.classList.contains("text-Sell")||t.className.includes("text-Sell")||s<0?"-":"",r=K(Math.abs(i),"size"),a=`${l}${r}\nUSDT`;if(t.textContent.replace(/\s+/g," ").trim()!==a.replace(/[\n\r]/g," ").trim()){try{t.innerHTML=`${l}${r}<br>USDT`}catch(e){t.textContent=`${l}${r} USDT`}d.add(t),u.add(t),f.set(t,Date.now()),re(t,a),setTimeout((()=>{if(t.textContent&&!t.textContent.includes(r)){console.warn("PNL Modifier: Size update verification failed, retrying...");try{t.innerHTML=`${l}${r}<br>USDT`}catch(e){t.textContent=`${l}${r} USDT`}}}),50)}}}catch(e){console.warn("PNL Modifier: Error processing size element:",e)}}function re(t,o){if(!u.has(t))return;const n=new MutationObserver((s=>{if(!document.body.contains(t))return n.disconnect(),void delete t._sizeProtectionObserver;s.forEach((n=>{if("characterData"===n.type||"childList"===n.type)try{let n=t.textContent.trim();if(!n.includes("USDT")&&t.querySelector){const e=t.querySelector("*");e&&(n=e.textContent.trim())}const s=n.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(!s||!s[1])return;const i=parseFloat(s[1].replace(/,/g,"")),l=o.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(!l||!l[1])return;const r=parseFloat(l[1].replace(/,/g,""));if(Math.abs(i-r)>.01){if(Q(i,c.get(t))){c.set(t,i);const o=i*e,n=t.classList.contains("text-Sell")||t.className.includes("text-Sell")||i<0?"-":"",s=K(Math.abs(o),"size"),l=`${n}${s}\nUSDT`;try{t.innerHTML=`${n}${s}<br>USDT`}catch(e){t.textContent=`${n}${s} USDT`}return t._sizeProtectionObserver&&t._sizeProtectionObserver.disconnect(),void re(t,l)}try{o.includes("\n")?t.innerHTML=o.replace("\n","<br>"):t.innerHTML=o}catch(e){t.textContent=o.replace("\n"," ")}setTimeout((()=>{if(!t.textContent.trim().includes(l[1]))try{t.innerHTML=o.replace("\n","<br>")}catch(e){t.textContent=o.replace("\n"," ")}}),25)}}catch(e){console.warn("PNL Modifier: Error in size protection:",e)}}))}));n.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._sizeProtectionObserver=n}function ae(t,o){if(!a.has(t))return;const n=new MutationObserver((s=>{if(!document.body.contains(t))return n.disconnect(),void delete t._protectionObserver;s.forEach((n=>{if("characterData"===n.type||"childList"===n.type)try{const n=t.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(!n||!n[1])return;const s=parseFloat(n[1].replace(/,/g,"")),l=o.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(!l||!l[1])return;const r=parseFloat(l[1].replace(/,/g,""));if(Math.abs(s-r)>.01){const n=t.closest('div[style*="flex: 1 0 140px"]')||t.closest('div[style*="flex:1 0 140px"]');if(n&&J(s,i.get(n))){i.set(n,s);const o=s*e,l=`${o>0?"+":o<0?"-":""}${K(Math.abs(o),"pnl")} USDT`;return t.textContent=l,t._protectionObserver&&t._protectionObserver.disconnect(),void ae(t,l)}t.textContent=o}}catch(e){console.warn("PNL Modifier: Error in PNL protection:",e)}}))}));n.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._protectionObserver=n}function ce(t,o){if(!a.has(t))return;const n=new MutationObserver((s=>{if(!document.body.contains(t))return n.disconnect(),void delete t._mobilePnlProtectionObserver;s.forEach((n=>{if(("characterData"===n.type||"childList"===n.type)&&!t._updatingFromRoi)try{const n=t.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(!n||!n[1])return;const s=parseFloat(n[1].replace(/,/g,"")),l=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(!l||!l[1])return;const r=parseFloat(l[1].replace(/,/g,""));if(Math.abs(s-r)>.01){if(J(s,i.get(t))){i.set(t,s);const o=s*e,n=`${o>0?"+":o<0?"-":""}${K(Math.abs(o),"pnl")}`;return t.textContent=n,t._mobilePnlProtectionObserver&&t._mobilePnlProtectionObserver.disconnect(),void ce(t,n)}t.textContent=o}}catch(e){console.warn("PNL Modifier: Error in mobile PNL protection:",e)}}))}));n.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._mobilePnlProtectionObserver=n}function de(t,o){if(!y.has(t))return;const n=new MutationObserver((s=>{if(!document.body.contains(t))return n.disconnect(),void delete t._mobileSizeProtectionObserver;s.forEach((n=>{if("characterData"===n.type||"childList"===n.type)try{const n=t.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(!n||!n[1])return;const s=parseFloat(n[1].replace(/,/g,"")),i=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(!i||!i[1])return;const l=parseFloat(i[1].replace(/,/g,""));if(Math.abs(s-l)>.01){if(Q(s,x.get(t))){x.set(t,s);const o=s*e,n=`${o<0?"-":""}${K(Math.abs(o),"size")}`;return t.textContent=n,t._mobileSizeProtectionObserver&&t._mobileSizeProtectionObserver.disconnect(),void de(t,n)}t.textContent=o}}catch(e){console.warn("PNL Modifier: Error in mobile size protection:",e)}}))}));n.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._mobileSizeProtectionObserver=n}function fe(t,o){if(!b.has(t))return;const n=new MutationObserver((s=>{if(!document.body.contains(t))return n.disconnect(),void delete t._mobileMarginProtectionObserver;s.forEach((n=>{try{let n="";if(n=t.firstChild&&3===t.firstChild.nodeType?t.firstChild.nodeValue.trim():t.textContent.trim(),n!==o&&n.match(/^[\d,]+\.?\d*$/)){const s=parseFloat(n.replace(/,/g,"")),i=p.get(t);if(i&&Q(s,i)){p.set(t,s);const o=s*e,n=`${o<0?"-":""}${K(Math.abs(o),"margin")}`;if(t.firstChild&&3===t.firstChild.nodeType)t.firstChild.nodeValue=n;else{const e=t.querySelector("svg");t.textContent=n,e&&t.appendChild(e)}S.set(t,Date.now())}else if(t.firstChild&&3===t.firstChild.nodeType)t.firstChild.nodeValue=o;else{const e=t.querySelector("svg");t.textContent=o,e&&t.appendChild(e)}}}catch(e){console.warn("PNL Modifier: Error in mobile margin protection:",e)}}))}));n.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._mobileMarginProtectionObserver=n}function ue(){const e=Date.now();e-B<(V?j:n)||(B=e,clearTimeout(U),U=setTimeout((()=>{Te()}),V?1.5*s:s))}function xe(e){F.add(e),clearTimeout(O),O=setTimeout((()=>{Array.from(F).filter(X).forEach(oe),F.clear()}),V?W:t)}function he(e){A.add(e),clearTimeout(D),D=setTimeout((()=>{Array.from(A).filter(X).forEach(ne),A.clear()}),V?W:t)}function me(e){k.add(e),clearTimeout(z),z=setTimeout((()=>{Array.from(k).filter(X).forEach(se),k.clear()}),V?W:t)}function ye(e){_.add(e),clearTimeout(q),q=setTimeout((()=>{Array.from(_).filter(X).forEach(le),_.clear()}),V?W:t)}function pe(e){R.add(e),clearTimeout(I),I=setTimeout((()=>{Array.from(R).filter(X).forEach(ie),R.clear()}),V?W:t)}function ge(t){Promise.resolve().then((()=>{document.body.contains(t)&&function(t){try{if(!document.body.contains(t))return;let o="";for(let e of t.childNodes)3===e.nodeType&&(o+=e.nodeValue);o=o.trim();const n=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(!n||!n[1])return;let s;if(M.has(t))s=M.get(t);else{if(s=parseFloat(n[1].replace(/,/g,"")),Math.abs(s)<.01)return void console.log("PNL Modifier: Share card PNL too small to modify:",s);M.set(t,s),t.dataset.originalSharePnl=s.toString(),t.dataset.originalText=o,console.log("PNL Modifier: Found share card PNL element:",{text:o,originalValue:s,classes:t.className})}const i=s*e,l=`${i>0?"+":i<0?"-":""}${K(Math.abs(i),"pnl")}`;let r=!1;for(let e of t.childNodes)3===e.nodeType&&e.nodeValue.trim()!==l&&(e.nodeValue=l,r=!0);r&&(N.add(t),w.add(t),E.set(t,Date.now()),Se(t,l),console.log("PNL Modifier: Updated share card PNL:",{original:o,modified:l,multiplier:e}))}catch(e){console.warn("PNL Modifier: Error processing share card PNL:",e)}}(t)}))}function Se(t,o){if(!w.has(t))return;const n=new MutationObserver((s=>{if(!document.body.contains(t))return n.disconnect(),void delete t._shareCardProtectionObserver;s.forEach((n=>{if("characterData"===n.type||"childList"===n.type)try{let n="";for(let e of t.childNodes)3===e.nodeType&&(n+=e.nodeValue);n=n.trim();const s=n.match(/^([+-]?[\d,]+\.?\d*)$/);if(!s||!s[1])return;const i=parseFloat(s[1].replace(/,/g,"")),l=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(!l||!l[1])return;const r=parseFloat(l[1].replace(/,/g,""));if(Math.abs(i-r)>.01){const n=M.get(t);if(n&&J(i,n)){M.set(t,i);const o=i*e,n=`${o>0?"+":o<0?"-":""}${K(Math.abs(o),"pnl")}`;for(let e of t.childNodes)3===e.nodeType&&(e.nodeValue=n);return t._shareCardProtectionObserver&&t._shareCardProtectionObserver.disconnect(),void Se(t,n)}for(let e of t.childNodes)3===e.nodeType&&(e.nodeValue=o)}}catch(e){console.warn("PNL Modifier: Error in share card PNL protection:",e)}}))}));n.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._shareCardProtectionObserver=n,setTimeout((()=>{document.body.contains(t)||n.disconnect()}),6e4)}function be(e){if(window._pnlModifierProcessing)return;window._pnlModifierProcessing=!0,setTimeout((()=>{window._pnlModifierProcessing=!1}),0);const t=new Set,o=new Set,n=new Set,s=new Set,l=new Set;try{for(const r of e){if("childList"===r.type&&r.addedNodes.length>0&&r.addedNodes.forEach((e=>{1===e.nodeType&&(G.positionCards.forEach((t=>{try{(e.querySelectorAll?e.querySelectorAll(t):[]).forEach((e=>{!L.has(e)&&X(e)&&ee(e)})),e.matches&&e.matches(t)&&!L.has(e)&&X(e)&&ee(e)}catch(e){}})),G.pnlContainers.forEach((o=>{try{if((e.querySelectorAll?e.querySelectorAll(o):[]).forEach((e=>{const o=Y(e,G.truncateElements);o&&o.textContent.includes("USDT")&&t.add(e)})),e.matches&&e.matches(o)){const o=Y(e,G.truncateElements);o&&o.textContent.includes("USDT")&&t.add(e)}}catch(e){}})),G.mobilePnlElements.forEach((t=>{try{if((e.querySelectorAll?e.querySelectorAll(t):[]).forEach((e=>{if(e.textContent.trim().match(/^[+-]?[\d,]+\.?\d*$/)&&(e.classList.contains("text-TextSell")||e.classList.contains("text-TextBuy"))){const t=e.closest(".flex.justify-between.mb-\\[8px\\]")||e.closest(".flex.justify-between");if(t){const o=t.querySelector('[class*="t-caption1"]');o&&o.textContent.includes("Unrealized PNL")&&n.add(e)}}})),e.matches&&e.matches(t)&&e.textContent.trim().match(/^[+-]?[\d,]+\.?\d*$/)&&(e.classList.contains("text-TextSell")||e.classList.contains("text-TextBuy"))){const t=e.closest(".flex.justify-between.mb-\\[8px\\]")||e.closest(".flex.justify-between");if(t){const o=t.querySelector('[class*="t-caption1"]');o&&o.textContent.includes("Unrealized PNL")&&n.add(e)}}}catch(e){}})),G.mobileSizeElements.forEach((t=>{try{if((e.querySelectorAll?e.querySelectorAll(t):[]).forEach((e=>{const o=e.textContent.trim();if(o.match(/^[+-]?[\d,]+\.?\d*$/)&&!e.classList.contains("text-TextSell")&&!e.classList.contains("text-TextBuy")&&e.classList.contains("t-body2")&&e.closest(".grid.grid-cols-3")){const n=e.closest(".flex.flex-col.items-left")||e.closest(".flex.flex-col");if(n){const i=n.querySelector('[class*="t-caption1"]');i&&i.textContent.includes("Size")?(s.add(e),console.log("PNL Modifier: Found mobile size element (node added):",{text:o,selector:t,hasLabel:!!i})):i&&i.textContent.includes("Margin")&&(l.add(e),console.log("PNL Modifier: Found mobile margin element (node added):",{text:o,selector:t,hasLabel:!!i}))}}})),e.matches&&e.matches(t)){const o=e.textContent.trim();if(o.match(/^[+-]?[\d,]+\.?\d*$/)&&!e.classList.contains("text-TextSell")&&!e.classList.contains("text-TextBuy")&&e.classList.contains("t-body2")&&e.closest(".grid.grid-cols-3")){const n=e.closest(".flex.flex-col.items-left")||e.closest(".flex.flex-col");if(n){const i=n.querySelector('[class*="t-caption1"]');i&&i.textContent.includes("Size")?(s.add(e),console.log("PNL Modifier: Found mobile size element (node itself):",{text:o,selector:t,hasLabel:!!i})):i&&i.textContent.includes("Margin")&&(l.add(e),console.log("PNL Modifier: Found mobile margin element (node itself):",{text:o,selector:t,hasLabel:!!i}))}}}}catch(e){}})),G.sizeContainers.forEach((t=>{try{if((e.querySelectorAll?e.querySelectorAll(t):[]).forEach((e=>{const t=e.textContent.includes("USDT"),n=e.classList.contains("text-Sell")||e.classList.contains("text-Buy")||e.className.includes("text-Sell")||e.className.includes("text-Buy"),s=e.style.flex&&(e.style.flex.includes("100px")||e.style.flex.includes("100"));t&&(n||s)&&o.add(e)})),e.matches&&e.matches(t)){const t=e.textContent.includes("USDT"),n=e.classList.contains("text-Sell")||e.classList.contains("text-Buy")||e.className.includes("text-Sell")||e.className.includes("text-Buy"),s=e.style.flex&&(e.style.flex.includes("100px")||e.style.flex.includes("100"));t&&(n||s)&&o.add(e)}}catch(e){}})))})),("characterData"===r.type||"childList"===r.type)&&r.target.classList&&r.target.classList.contains("truncate")){let e=r.target;if(1!==e.nodeType&&(e=e.parentElement),e&&e.closest){const o=e.closest('div[style*="flex: 1 0 140px"]')||e.closest('div[style*="flex:1 0 140px"]');if(o){const e=Y(o,G.truncateElements);if(e&&e.textContent.includes("USDT")){const n=e.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(n&&n[1]){const e=parseFloat(n[1].replace(/,/g,""));J(e,i.get(o))&&(i.set(o,e),t.add(o))}}}}}if("characterData"===r.type||"childList"===r.type){let e=r.target;if(1!==e.nodeType&&(e=e.parentElement),e&&e.classList&&(e.classList.contains("text-TextSell")||e.classList.contains("text-TextBuy"))&&e.classList.contains("t-body2")){const t=e.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(t&&t[1]){const o=e.closest(".flex.justify-between.mb-\\[8px\\]")||e.closest(".flex.justify-between");if(o){const s=o.querySelector('[class*="t-caption1"]');if(s&&s.textContent.includes("Unrealized PNL")){const o=parseFloat(t[1].replace(/,/g,""));J(o,i.get(e))&&(i.set(e,o),n.add(e))}}}}}if("characterData"===r.type||"childList"===r.type){let e=r.target;if(1!==e.nodeType&&(e=e.parentElement),e&&e.classList&&e.classList.contains("t-body2")&&!e.classList.contains("text-TextSell")&&!e.classList.contains("text-TextBuy")){const t=e.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(t&&t[1]){const o=e.closest(".grid.grid-cols-3"),n=o?.querySelector('[class*="t-caption1"]');if(n&&n.textContent.includes("Size")){const o=parseFloat(t[1].replace(/,/g,""));Q(o,x.get(e))&&(x.set(e,o),s.add(e))}}}}if("characterData"===r.type||"childList"===r.type){let e=r.target;if(1!==e.nodeType&&(e=e.parentElement),e&&e.style){const t=e.style.flex,n="1 0 100px"===t||"1 0 100px"===t||"1 0 100"===t||"1 0 100px"===t||t.includes("100px")||t.includes("100"),s=e.textContent.includes("USDT"),i=e.classList.contains("text-Sell")||e.classList.contains("text-Buy")||e.className.includes("text-Sell")||e.className.includes("text-Buy");if(n&&s&&i){const t=e.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(t&&t[1]){const n=parseFloat(t[1].replace(/,/g,""));Q(n,c.get(e))&&(c.set(e,n),o.add(e))}}if(e.querySelector){const t=e.querySelector('[class*="text-"][style*="flex"]')||e.querySelector('[style*="100px"]');if(t&&t.textContent.includes("USDT")&&(t.classList.contains("text-Sell")||t.classList.contains("text-Buy"))){const e=t.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(e&&e[1]){const n=parseFloat(e[1].replace(/,/g,""));Q(n,c.get(t))&&(c.set(t,n),o.add(t))}}}}}if("characterData"===r.type||"childList"===r.type){let e=r.target;if(1!==e.nodeType&&(e=e.parentElement),e&&e.classList&&e.textContent.includes("%")&&(e.classList.contains("text-TextSell")||e.classList.contains("text-TextBuy"))&&(e.classList.contains("t-caption1")||e.classList.contains("typography-caption2"))){const t=v.get(e);if(t){const o=Z(e);if(null!==o){const n=T.get(e);(void 0===n||Math.abs(o-n)>1e-4)&&(T.set(e,o),te(t),console.log("PNL Modifier: ROI changed, recalculating PNL:",{oldRoi:n?`${(100*n).toFixed(2)}%`:"initial",newRoi:`${(100*o).toFixed(2)}%`}))}}}}}t.forEach((e=>xe(e))),n.forEach((e=>he(e))),o.forEach((e=>ye(e))),s.forEach((e=>me(e))),l.forEach((e=>pe(e)))}catch(e){console.warn("PNL Modifier: Error handling mutations:",e)}}function Te(){try{G.positionCards.forEach((e=>{try{document.querySelectorAll(e).forEach((e=>{X(e)&&!L.has(e)&&ee(e)}))}catch(e){}})),document.querySelectorAll('div[style*="flex: 1 0 140px"], div[style*="flex:1 0 140px"]').forEach((e=>{if(X(e)){const t=Y(e,G.truncateElements);t&&t.textContent.includes("USDT")&&!l.has(t)&&xe(e)}})),G.mobilePnlElements.forEach((e=>{try{document.querySelectorAll(e).forEach((t=>{if(X(t)){const o=t.textContent.trim();if(o.match(/^[+-]?[\d,]+\.?\d*$/)&&(t.classList.contains("text-TextSell")||t.classList.contains("text-TextBuy"))&&!l.has(t)){const n=t.closest(".flex.justify-between.mb-\\[8px\\]")||t.closest(".flex.justify-between");if(n){const s=n.querySelector('[class*="t-caption1"]');s&&s.textContent.includes("Unrealized PNL")&&(V&&console.log("PNL Modifier (macOS): Scheduling mobile PNL update for:",{text:o,selector:e,classes:t.className,hasTextSell:t.classList.contains("text-TextSell"),hasTextBuy:t.classList.contains("text-TextBuy")}),he(t))}}}}))}catch(t){V&&console.warn("PNL Modifier (macOS): Mobile PNL selector failed:",e,t)}})),G.mobileSizeElements.forEach((e=>{try{document.querySelectorAll(e).forEach((t=>{if(X(t)){const o=t.textContent.trim();if(o.match(/^([+-]?[\d,]+\.?\d*)$/)&&!t.classList.contains("text-TextSell")&&!t.classList.contains("text-TextBuy")&&t.classList.contains("t-body2")&&!h.has(t)&&t.closest(".grid.grid-cols-3")){const n=t.closest(".flex.flex-col.items-left")||t.closest(".flex.flex-col");if(n){const s=n.querySelector('[class*="t-caption1"]');s&&s.textContent.includes("Size")&&(me(t),console.log("PNL Modifier: Scheduled mobile size element update:",{text:o,selector:e,hasLabel:!!s}))}}}}))}catch(e){}})),G.mobileMarginElements.forEach((e=>{try{document.querySelectorAll(e).forEach((e=>{if(!e.classList.contains("text-TextSell")&&!e.classList.contains("text-TextBuy")&&e.classList.contains("t-body2")&&!g.has(e)&&X(e)){const t=e.closest(".flex.flex-col");if(t){const o=t.querySelector('[class*="t-caption1"]');if(o&&o.textContent.includes("Margin")){(e.firstChild?.nodeValue?.trim()||e.textContent.trim()).match(/^[\d,]+\.?\d*$/)&&pe(e)}}}}))}catch(e){}})),G.shareCardContainers.forEach((e=>{try{document.querySelectorAll(e).forEach((e=>{X(e)&&G.shareCardPnlElements.forEach((t=>{const o=e.querySelector(t);o&&!N.has(o)&&(ge(o),console.log("PNL Modifier: Processing share card PNL in full scan"))}))}))}catch(e){}})),['div[style*="flex: 1 0 100px"]','div[style*="flex:1 0 100px"]','div[style*="flex: 1 0 100"]','div[style*="flex:1 0 100"]','[style*="100px"][class*="text-"]','[class*="text-Sell"][style*="flex"]','[class*="text-Buy"][style*="flex"]'].forEach((e=>{try{document.querySelectorAll(e).forEach((e=>{if(X(e)){const t=e.textContent.includes("USDT"),o=e.classList.contains("text-Sell")||e.classList.contains("text-Buy")||e.className.includes("text-Sell")||e.className.includes("text-Buy"),n=e.style.flex&&(e.style.flex.includes("100px")||e.style.flex.includes("100"));t&&(o||n)&&!d.has(e)&&ye(e)}}))}catch(e){}}))}catch(e){console.warn("PNL Modifier: Error in performUpdates:",e)}}function Le(){try{let t=null;for(const e of G.containers)if(t=document.querySelector(e),t){console.log(`PNL Modifier: Found container with selector: ${e}`);break}t||(t=document.body,console.log("PNL Modifier: Using body as fallback container")),console.log(`PNL Modifier: Observing ${t.id||t.nodeName}`),new MutationObserver(be).observe(t,{childList:!0,subtree:!0,characterData:!0,attributes:!1});new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.length&&e.addedNodes.forEach((e=>{if(1===e.nodeType&&(("share-position-poster"===e.id||"web-share-sdk-share-poster"===e.id||e.matches&&e.matches("#share-position-poster, #web-share-sdk-share-poster"))&&($.has(e)||($.add(e),console.log("PNL Modifier: Share card detected via dedicated observer"),setTimeout((()=>{G.shareCardPnlElements.forEach((t=>{const o=e.querySelector(t);o&&!N.has(o)&&ge(o)}))}),50))),e.querySelector)){const t=e.querySelector("#share-position-poster, #web-share-sdk-share-poster");t&&!$.has(t)&&($.add(t),console.log("PNL Modifier: Share card detected in wrapper via dedicated observer"),setTimeout((()=>{G.shareCardPnlElements.forEach((e=>{const o=t.querySelector(e);o&&!N.has(o)&&ge(o)}))}),50))}}))}))})).observe(document.body,{childList:!0,subtree:!1}),console.log("PNL Modifier: Dedicated share card observer active (subtree:false for performance)"),Te();const n={passive:!0,capture:!1};window.addEventListener("scroll",ue,n),document.addEventListener("wheel",ue,n),[t,...document.querySelectorAll('div[style*="overflow"]'),...document.querySelectorAll('div[style*="overflow-x"]')].filter(Boolean).forEach((e=>{e!==document.body&&e.addEventListener("scroll",ue,n)})),window.addEventListener("resize",(()=>{setTimeout(Te,100)}),n),setInterval((()=>{const t=Date.now();try{i.forEach(((e,t)=>{document.body.contains(t)||(t._protectionObserver?.disconnect(),t._mobilePnlProtectionObserver?.disconnect())})),c.forEach(((e,t)=>{document.body.contains(t)||t._sizeProtectionObserver?.disconnect()})),x.forEach(((e,t)=>{document.body.contains(t)||t._mobileSizeProtectionObserver?.disconnect()})),p.forEach(((e,t)=>{document.body.contains(t)||t._mobileMarginProtectionObserver?.disconnect()})),M.forEach(((e,t)=>{document.body.contains(t)||t._shareCardProtectionObserver?.disconnect()}))}catch(e){console.warn("PNL Modifier: Error cleaning up observers:",e)}L.forEach(((e,t)=>{document.body.contains(t)?te(t):L.delete(t)}));for(const[e,n]of r.entries())t-n>o&&(r.delete(e),i.delete(e));for(const[e,n]of f.entries())t-n>o&&(f.delete(e),c.delete(e));for(const[e,n]of m.entries())t-n>o&&(m.delete(e),x.delete(e));Te(),document.querySelectorAll('div[style*="flex: 1 0 140px"], div[style*="flex:1 0 140px"]').forEach((t=>{const o=Y(t,G.truncateElements);if(o&&i.has(t)){const n=o.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(n&&n[1]){const s=parseFloat(n[1].replace(/,/g,"")),l=i.get(t),r=l*e;if(Math.abs(s-r)>.01)if(J(s,l)){i.set(t,s);const n=s*e,l=`${n>0?"+":""}${K(Math.abs(n),"pnl")} USDT`;o.textContent=l,o._protectionObserver&&o._protectionObserver.disconnect(),ae(o,l)}else{const e=`${r>0?"+":""}${K(Math.abs(r),"pnl")} USDT`;o.textContent=e,a.has(o)||ae(o,e)}}}})),G.mobilePnlElements.forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{if(t.classList.contains("text-TextSell")&&i.has(t)){const o=t.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(o&&o[1]){const n=parseFloat(o[1].replace(/,/g,"")),s=i.get(t),l=s*e;if(Math.abs(n-l)>.01)if(J(n,s)){i.set(t,n);const o=n*e,s=`${o>0?"+":""}${K(Math.abs(o),"pnl")}`;t.textContent=s,t._mobilePnlProtectionObserver&&t._mobilePnlProtectionObserver.disconnect(),ce(t,s)}else{const e=`${l>0?"+":""}${K(Math.abs(l),"pnl")}`;t.textContent=e,a.has(t)||ce(t,e)}}}}))}catch(e){}})),G.mobileSizeElements.forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{if(!t.classList.contains("text-TextSell")&&!t.classList.contains("text-TextBuy")&&t.classList.contains("t-body2")&&x.has(t)){const o=t.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(o&&o[1]){const n=parseFloat(o[1].replace(/,/g,"")),s=x.get(t),i=s*e;if(Math.abs(n-i)>.01)if(Q(n,s)){x.set(t,n);const o=n*e,s=(o<0?"-":"")+K(Math.abs(o),"size");t.textContent=s,t._mobileSizeProtectionObserver&&t._mobileSizeProtectionObserver.disconnect(),de(t,s)}else{const e=(i<0?"-":"")+K(Math.abs(i),"size");t.textContent=e,y.has(t)||de(t,e)}}}}))}catch(e){}})),G.mobileMarginElements.forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{if(!t.classList.contains("text-TextSell")&&!t.classList.contains("text-TextBuy")&&t.classList.contains("t-body2")&&p.has(t)){let o="";o=t.firstChild&&3===t.firstChild.nodeType?t.firstChild.nodeValue.trim():t.textContent.trim();const n=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(n&&n[1]){const o=parseFloat(n[1].replace(/,/g,"")),s=p.get(t),i=s*e;if(Math.abs(o-i)>.01)if(Q(o,s)){p.set(t,o);const n=o*e,s=(n<0?"-":"")+K(Math.abs(n),"margin");if(t.firstChild&&3===t.firstChild.nodeType)t.firstChild.nodeValue=s;else{const e=t.querySelector("svg");t.textContent=s,e&&t.appendChild(e)}t._mobileMarginProtectionObserver&&t._mobileMarginProtectionObserver.disconnect(),fe(t,s)}else{const e=(i<0?"-":"")+K(Math.abs(i),"margin");if(t.firstChild&&3===t.firstChild.nodeType)t.firstChild.nodeValue=e;else{const o=t.querySelector("svg");t.textContent=e,o&&t.appendChild(o)}b.has(t)||fe(t,e)}}}}))}catch(e){}})),G.shareCardContainers.forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{G.shareCardPnlElements.forEach((o=>{const n=t.querySelector(o);if(n&&M.has(n)){let t="";for(let e of n.childNodes)3===e.nodeType&&(t+=e.nodeValue);t=t.trim();const o=t.match(/^([+-]?[\d,]+\.?\d*)$/);if(o&&o[1]){const t=parseFloat(o[1].replace(/,/g,"")),s=M.get(n),i=s*e;if(Math.abs(t-i)>.01)if(J(t,s)){M.set(n,t);const o=t*e,s=`${o>0?"+":""}${K(Math.abs(o),"pnl")}`;for(let e of n.childNodes)3===e.nodeType&&(e.nodeValue=s);n._shareCardProtectionObserver&&n._shareCardProtectionObserver.disconnect(),Se(n,s)}else{const e=`${i>0?"+":""}${K(Math.abs(i),"pnl")}`;for(let t of n.childNodes)3===t.nodeType&&(t.nodeValue=e);w.has(n)||Se(n,e)}}}}))}))}catch(e){}}));for(const[e,o]of E.entries())(!document.body.contains(e)||t-o>6e4)&&(E.delete(e),M.delete(e));['div[style*="flex: 1 0 100px"]','div[style*="flex:1 0 100px"]','div[style*="flex: 1 0 100"]','div[style*="flex:1 0 100"]','[style*="100px"][class*="text-"]','[class*="text-Sell"][style*="flex"]','[class*="text-Buy"][style*="flex"]'].forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{const o=t.textContent.includes("USDT"),n=t.classList.contains("text-Sell")||t.classList.contains("text-Buy")||t.className.includes("text-Sell")||t.className.includes("text-Buy"),s=t.style.flex&&(t.style.flex.includes("100px")||t.style.flex.includes("100"));if(o&&(n||s)&&c.has(t)){const o=t.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(o&&o[1]){const n=parseFloat(o[1].replace(/,/g,"")),s=c.get(t),i=s*e;if(Math.abs(n-i)>.01)if(Q(n,s)){c.set(t,n);const o=n*e,s=t.classList.contains("text-Sell")||t.className.includes("text-Sell")||n<0?"-":"",i=K(Math.abs(o),"size"),l=`${s}${i}\nUSDT`;try{t.innerHTML=`${s}${i}<br>USDT`}catch(e){t.textContent=`${s}${i} USDT`}t._sizeProtectionObserver&&t._sizeProtectionObserver.disconnect(),re(t,l)}else{const e=t.classList.contains("text-Sell")||t.className.includes("text-Sell")||i<0?"-":"",o=K(Math.abs(i),"size"),n=`${e}${o}\nUSDT`;try{t.innerHTML=`${e}${o}<br>USDT`}catch(n){t.textContent=`${e}${o} USDT`}u.has(t)||re(t,n)}}}}))}catch(e){}}))}),1e4),console.log(`Ultra-Optimized PNL Modifier started successfully! (${V?"macOS":"Windows"} optimized)`),console.log("âœ¨ NEW: Real-time PNL calculation enabled! PNL will update automatically when ROI changes."),console.log("ðŸ“Š Formula: PNL = ROI Ã— Margin Ã— "+e.toLocaleString()),console.log("ðŸ”’ ROBUST: Original values stored in dataset - immune to formatting changes"),V&&setTimeout((()=>{const e=document.querySelectorAll('[style*="100px"], [class*="text-Sell"], [class*="text-Buy"]');console.log(`PNL Modifier: Found ${e.length} potential size elements on macOS`);let t=0;e.forEach((e=>{e.textContent.includes("USDT")&&(t++,console.log("PNL Modifier: Valid size element found:",{text:e.textContent.trim(),flex:e.style.flex,classes:e.className,hasUSDT:e.textContent.includes("USDT")}))})),console.log(`PNL Modifier: ${t} valid size elements with USDT found on macOS`)}),2e3),setTimeout((()=>{const e=document.querySelectorAll(".text-TextSell.t-body2");console.log(`PNL Modifier: Found ${e.length} potential mobile PNL elements`);let t=0;e.forEach((e=>{const o=e.textContent.trim();o.match(/^[+-]?[\d,]+\.?\d*$/)&&(t++,console.log("PNL Modifier: Valid mobile PNL element found:",{text:o,classes:e.className,parent:e.parentElement?e.parentElement.className:"no parent"}))})),console.log(`PNL Modifier: ${t} valid mobile PNL elements found`),V&&(console.log("PNL Modifier (macOS): Testing all mobile PNL selectors..."),G.mobilePnlElements.forEach(((e,t)=>{try{const o=document.querySelectorAll(e);console.log(`PNL Modifier (macOS): Selector ${t+1} (${e}): found ${o.length} elements`),o.forEach(((e,t)=>{const o=e.textContent.trim(),n=e.classList.contains("text-TextSell"),s=o.match(/^[+-]?[\d,]+\.?\d*$/);console.log(`  Element ${t+1}: "${o}", hasTextSell: ${n}, matchesPattern: ${!!s}`)}))}catch(t){console.warn(`PNL Modifier (macOS): Selector failed: ${e}`,t)}})));const o=document.querySelector("#POSITIONS");if(o){console.log("PNL Modifier: POSITIONS container found");const e=o.querySelectorAll(".py-\\[16px\\]");console.log(`PNL Modifier: Found ${e.length} position divs`)}else console.log("PNL Modifier: POSITIONS container NOT found")}),3e3),setTimeout((()=>{const e=document.querySelectorAll("#POSITIONS .t-body2:not(.text-TextSell)");console.log(`PNL Modifier: Found ${e.length} potential mobile size elements`);let t=0;e.forEach((e=>{const o=e.textContent.trim(),n=e.closest(".grid.grid-cols-3"),s=n?.querySelector('[class*="t-caption1"]');o.match(/^[\d,]+\.?\d*$/)&&s&&s.textContent.includes("Size")&&(t++,console.log(`Mobile Size Element: "${o}" in context: "${s.textContent}"`))})),console.log(`PNL Modifier: ${t} valid mobile size elements found`)}),4e3),setTimeout((()=>{console.log("\n=== MOBILE MARGIN DIAGNOSTIC ===");const e=document.querySelectorAll("#POSITIONS .grid.grid-cols-3 .flex.flex-col:not(.items-left):not(.items-end) .t-body2");console.log(`PNL Modifier: Found ${e.length} potential mobile margin elements`);let t=0;e.forEach((e=>{const o=3===e.firstChild?.nodeType?e.firstChild.nodeValue.trim():e.textContent.trim(),n=e.closest(".flex.flex-col"),s=n?.querySelector('[class*="t-caption1"]'),i=null!==e.querySelector("svg");o.match(/^[\d,]+\.?\d*$/)&&s&&s.textContent.includes("Margin")&&(t++,console.log(`Mobile Margin Element: "${o}" (SVG: ${i}) in context: "${s.textContent}"`))})),console.log(`PNL Modifier: ${t} valid mobile margin elements found`),console.log(`Modified margin count: ${g.size||0}`),console.log(`Tracked margin values: ${p.size}`)}),5e3),setTimeout((()=>{console.log("\n=== ROI-BASED PNL TRACKING DIAGNOSTIC ==="),console.log(`Position cards linked: ${L.size}`),console.log(`ROI elements tracked: ${T.size}`),L.forEach(((e,t)=>{const o=T.get(e.roi),n=e.roi?.textContent.trim()||"N/A",s=e.margin?.textContent.trim()||"N/A",i=e.pnl?.textContent.trim()||"N/A";console.log("Position Card:",{ROI:n,"ROI Value":void 0!==o?`${(100*o).toFixed(2)}%`:"N/A",Margin:s.substring(0,20),PNL:i.substring(0,30),"Card Visible":X(t)})})),0===L.size?(console.warn("âš ï¸ No position cards linked! ROI tracking may not be working."),console.log("Checking for position cards in DOM..."),G.positionCards.forEach((e=>{const t=document.querySelectorAll(e);console.log(`  ${e}: ${t.length} found`)}))):console.log("âœ… ROI tracking is active and will update PNL in real-time!")}),6e3)}catch(e){console.error("PNL Modifier: Error during initialization:",e)}}function Pe(){let e=0;const t=setInterval((()=>{e++;try{const o=document.querySelectorAll('div[style*="flex: 1 0 140px"], div[style*="flex:1 0 140px"]').length>0,n=G.containers.some((e=>document.querySelector(e))),s=document.querySelector('div[class*="bn-"]')||document.querySelector('div[class*="binance"]')||document.body.children.length>5;(o||n||s||e>=50)&&(clearInterval(t),Le(),o||n?console.log("PNL Modifier: Started successfully after "+e+" attempts"):console.log("PNL Modifier: Started in fallback mode after "+e+" attempts"))}catch(o){console.warn("PNL Modifier: Error during startup check:",o),e>=50&&(clearInterval(t),Le())}}),V?H:150)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Pe):setTimeout(Pe,V?300:100)}();