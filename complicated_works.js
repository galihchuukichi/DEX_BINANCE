!function(){"use strict";const e=1e4,t=50,s=3e4,o=16,n=100,l=new Map,c=new WeakSet,i=new Map,a=new WeakSet,r=new Map,d=new WeakSet,x=new Map,f=new WeakSet,u=new Map,m=new WeakSet,y=new Map,h=new WeakSet;let S,p,b,T,g,L=0,P=new Set,v=new Set,w=new Set,N=new Set;const M=navigator.platform.toLowerCase().includes("mac")||navigator.userAgent.toLowerCase().includes("mac")||navigator.platform.toLowerCase().includes("darwin")||/macintosh|mac os x/i.test(navigator.userAgent),C=M?75:t,$=M?250:150,E=M?25:o,D={pnlContainers:['div[style*="flex: 1 0 140px"]','div[style*="flex:1 0 140px"]','div[style*="flex: 1"]',".truncate-parent"],sizeContainers:['div[style*="flex: 1 0 100px"]','div[style*="flex:1 0 100px"]','div[style*="flex:1"]','div[style*="flex: 1 0 100"]','div[style*="flex:1 0 100"]','[style*="100px"][class*="text-"]','[class*="text-Sell"][style*="flex"]','[class*="text-Buy"][style*="flex"]','div[style*="width: 100px"][style*="flex"]','.text-Buy[style*="100px"]','.text-Sell[style*="100px"]','[style*="flex: 1"][class*="typography-caption2"]'],mobilePnlContainers:["#POSITIONS .py-\\[16px\\]",'#POSITIONS div[class*="py-[16px]"]',".py-\\[16px\\]",'[class*="py-[16px]"]'],mobilePnlElements:[".flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis.text-TextSell",".flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis.text-TextBuy",'.text-TextSell[class*="t-body2"]','.text-TextBuy[class*="t-body2"]','[class*="text-TextSell"][class*="t-body2"]','[class*="text-TextBuy"][class*="t-body2"]',".t-body2.text-TextSell",".t-body2.text-TextBuy",".text-TextSell.t-body2",".text-TextBuy.t-body2",'div.text-TextSell[class*="t-body2"]','div.text-TextBuy[class*="t-body2"]','[class="flex text-PrimaryText t-body2 whitespace-nowrap overflow-hidden text-ellipsis text-TextSell"]','[class="flex text-PrimaryText t-body2 whitespace-nowrap overflow-hidden text-ellipsis text-TextBuy"]'],mobileSizeContainers:["#POSITIONS .grid.grid-cols-3.gap-\\[8px\\].mb-\\[8px\\]",'#POSITIONS div[class*="grid-cols-3"]',".grid.grid-cols-3",'[class*="grid-cols-3"]'],mobileSizeElements:[".flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis:not(.text-TextSell):not(.text-TextBuy)","#POSITIONS .flex.flex-col.items-left .flex.text-PrimaryText.t-body2",".grid-cols-3 .flex.flex-col.items-left .flex.text-PrimaryText.t-body2",".flex.flex-col.items-left .t-body2:not(.text-TextSell):not(.text-TextBuy)",".grid-cols-3 .flex.text-PrimaryText.t-body2:not(.text-TextSell):not(.text-TextBuy)","#POSITIONS .grid .flex.text-PrimaryText.t-body2:not(.text-TextSell):not(.text-TextBuy)","#POSITIONS .grid.grid-cols-3 .flex.flex-col.items-left .flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis",".grid.grid-cols-3.gap-\\[8px\\].mb-\\[8px\\] .flex.flex-col.items-left .flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis"],containers:[".fixed-size-list",".list-container",'[id*="position"]',"#POSITIONS",'[class*="position"]','div[style*="overflow: auto"]','div[style*="overflow-x: auto"]','div[style*="overflow:auto"]','div[style*="overflow-x:auto"]'],truncateElements:[".truncate",".text-truncate",'[class*="truncate"]']};function O(e,t=!1,s=!1){const o=Math.abs(e),n=(Math.floor(99*Math.random())+1).toString().padStart(2,"0");return`${Math.floor(o).toLocaleString("en-US")}.${n}`}function U(t,s){if(!s)return!0;const o=s*e,n=Math.abs(t);return n<=.2*Math.abs(o)&&n>.01}function q(t,s){if(!s)return!0;const o=s*e,n=Math.abs(t);return n<=.2*Math.abs(o)&&n>.01}function z(e){try{if(!e||!document.body.contains(e))return!1;const t=e.getBoundingClientRect(),s=window.innerHeight||document.documentElement.clientHeight,o=window.innerWidth||document.documentElement.clientWidth,n=M?10:5;return t.top>=-n&&t.left>=-n&&t.bottom<=s+n&&t.right<=o+n&&t.width>0&&t.height>0}catch(e){return console.warn("PNL Modifier: Error checking viewport:",e),!1}}function B(e,t){for(const s of t)try{const t=e.querySelector(s);if(t)return t}catch(e){continue}return null}function A(t){try{if(!document.body.contains(t)||null===t.offsetParent)return;const s=B(t,D.truncateElements);if(!s)return;const o=s.textContent.trim(),n=o.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(n&&n[1]){let r;l.has(t)?r=l.get(t):(r=parseFloat(n[1].replace(/,/g,"")),l.set(t,r),s.dataset.originalText=o);const d=r*e,x=`${d>0?"+":d<0?"-":""}${O(Math.abs(d))} USDT`;s.textContent!==x&&(s.textContent=x,c.add(s),a.add(s),i.set(t,Date.now()),H(s,x))}}catch(e){console.warn("PNL Modifier: Error processing PNL element:",e)}}function F(t){try{if(!document.body.contains(t)||null===t.offsetParent)return;const s=t.textContent.trim(),o=s.match(/^([+-]?[\d,]+\.?\d*)$/);if(o&&o[1]){let n;l.has(t)?n=l.get(t):(n=parseFloat(o[1].replace(/,/g,"")),l.set(t,n),t.dataset.originalText=s,M&&console.log("PNL Modifier (macOS): Found mobile PNL element:",{text:s,originalValue:n,classes:t.className,hasTextSell:t.classList.contains("text-TextSell"),hasTextBuy:t.classList.contains("text-TextBuy")}));const r=n*e,d=`${r>0?"+":""}${O(Math.abs(r))}`;t.textContent!==d&&(t.textContent=d,c.add(t),a.add(t),i.set(t,Date.now()),W(t,d),M&&console.log("PNL Modifier (macOS): Updated mobile PNL element:",{original:s,modified:d,multiplier:e}))}}catch(e){console.warn("PNL Modifier: Error processing mobile PNL element:",e)}}function I(t){try{if(!document.body.contains(t)||null===t.offsetParent)return;const s=t.textContent.trim(),o=s.match(/^([+-]?[\d,]+\.?\d*)$/);if(o&&o[1]){let n;u.has(t)?n=u.get(t):(n=parseFloat(o[1].replace(/,/g,"")),u.set(t,n),t.dataset.originalText=s,console.log("PNL Modifier: Found mobile size element:",{text:s,originalValue:n,classes:t.className,isNegative:n<0}));const l=n*e,c=`${l<0?"-":""}${O(Math.abs(l))}`;t.textContent!==c&&(t.textContent=c,h.add(t),m.add(t),y.set(t,Date.now()),j(t,c),console.log("PNL Modifier: Updated mobile size element:",{original:s,modified:c,wasNegative:n<0}))}}catch(e){console.warn("PNL Modifier: Error processing mobile size element:",e)}}function _(t){try{if(!document.body.contains(t)||null===t.offsetParent)return;let s=t.textContent.trim();if(!s.includes("USDT")&&t.querySelector){const e=t.querySelector('[class*="text-"]')||t.querySelector('*[text*="USDT"]')||t.querySelector("span, div");e&&(s=e.textContent.trim())}const o=s.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(o&&o[1]){let n;r.has(t)?n=r.get(t):(n=parseFloat(o[1].replace(/,/g,"")),r.set(t,n),t.dataset.originalText=s);const l=n*e,c=t.classList.contains("text-Sell")||t.className.includes("text-Sell")||n<0?"-":"",i=O(Math.abs(l),!1,!0),a=`${c}${i}\nUSDT`,u=t.textContent.replace(/\s+/g," ").trim();if(u!==a.replace(/[\n\r]/g," ").trim()){try{t.innerHTML=`${c}${i}<br>USDT`}catch(e){t.textContent=`${c}${i} USDT`}d.add(t),f.add(t),x.set(t,Date.now()),k(t,a),setTimeout((()=>{if(t.textContent&&!t.textContent.includes(i)){console.warn("PNL Modifier: Size update verification failed, retrying...");try{t.innerHTML=`${c}${i}<br>USDT`}catch(e){t.textContent=`${c}${i} USDT`}}}),50)}}}catch(e){console.warn("PNL Modifier: Error processing size element:",e)}}function k(t,s){if(f.has(t)){const o=new MutationObserver((o=>{o.forEach((o=>{if("characterData"===o.type||"childList"===o.type)try{let o=t.textContent.trim();if(!o.includes("USDT")&&t.querySelector){const e=t.querySelector("*");e&&(o=e.textContent.trim())}const n=o.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(n&&n[1]){const o=parseFloat(n[1].replace(/,/g,"")),l=s.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(l&&l[1]){const n=parseFloat(l[1].replace(/,/g,""));if(Math.abs(o-n)>.01){if(q(o,r.get(t))){r.set(t,o);const s=o*e,n=t.classList.contains("text-Sell")||t.className.includes("text-Sell")||o<0?"-":"",l=O(Math.abs(s),!1,!0),c=`${n}${l}\nUSDT`;try{t.innerHTML=`${n}${l}<br>USDT`}catch(e){t.textContent=`${n}${l} USDT`}return t._sizeProtectionObserver&&t._sizeProtectionObserver.disconnect(),void k(t,c)}try{s.includes("\n")?t.innerHTML=s.replace("\n","<br>"):t.innerHTML=s}catch(e){t.textContent=s.replace("\n"," ")}setTimeout((()=>{if(!t.textContent.trim().includes(l[1]))try{t.innerHTML=s.replace("\n","<br>")}catch(e){t.textContent=s.replace("\n"," ")}}),25)}}}}catch(e){console.warn("PNL Modifier: Error in size protection:",e)}}))}));o.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._sizeProtectionObserver=o}}function H(t,s){if(a.has(t)){const o=new MutationObserver((o=>{o.forEach((o=>{if("characterData"===o.type||"childList"===o.type)try{const o=t.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(o&&o[1]){const n=parseFloat(o[1].replace(/,/g,"")),c=s.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(c&&c[1]){const o=parseFloat(c[1].replace(/,/g,""));if(Math.abs(n-o)>.01){const o=t.closest('div[style*="flex: 1 0 140px"]')||t.closest('div[style*="flex:1 0 140px"]');if(o&&U(n,l.get(o))){l.set(o,n);const s=n*e,c=`${s>0?"+":s<0?"-":""}${O(Math.abs(s))} USDT`;return t.textContent=c,t._protectionObserver&&t._protectionObserver.disconnect(),void H(t,c)}t.textContent=s}}}}catch(e){console.warn("PNL Modifier: Error in PNL protection:",e)}}))}));o.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._protectionObserver=o}}function W(t,s){if(a.has(t)){const o=new MutationObserver((o=>{o.forEach((o=>{if("characterData"===o.type||"childList"===o.type)try{const o=t.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(o&&o[1]){const n=parseFloat(o[1].replace(/,/g,"")),c=s.match(/^([+-]?[\d,]+\.?\d*)$/);if(c&&c[1]){const o=parseFloat(c[1].replace(/,/g,""));if(Math.abs(n-o)>.01){if(U(n,l.get(t))){l.set(t,n);const s=n*e,o=`${s>0?"+":s<0?"-":""}${O(Math.abs(s))}`;return t.textContent=o,t._mobilePnlProtectionObserver&&t._mobilePnlProtectionObserver.disconnect(),void W(t,o)}t.textContent=s}}}}catch(e){console.warn("PNL Modifier: Error in mobile PNL protection:",e)}}))}));o.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._mobilePnlProtectionObserver=o}}function j(t,s){if(m.has(t)){const o=new MutationObserver((o=>{o.forEach((o=>{if("characterData"===o.type||"childList"===o.type)try{const o=t.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(o&&o[1]){const n=parseFloat(o[1].replace(/,/g,"")),l=s.match(/^([+-]?[\d,]+\.?\d*)$/);if(l&&l[1]){const o=parseFloat(l[1].replace(/,/g,""));if(Math.abs(n-o)>.01){if(q(n,u.get(t))){u.set(t,n);const s=n*e,o=`${s<0?"-":""}${O(Math.abs(s))}`;return t.textContent=o,t._mobileSizeProtectionObserver&&t._mobileSizeProtectionObserver.disconnect(),void j(t,o)}t.textContent=s}}}}catch(e){console.warn("PNL Modifier: Error in mobile size protection:",e)}}))}));o.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._mobileSizeProtectionObserver=o}}function V(){const e=Date.now();if(e-L<(M?E:o))return;L=e,clearTimeout(g);g=setTimeout((()=>{X()}),M?1.5*n:n)}function R(e){P.add(e),clearTimeout(S);S=setTimeout((()=>{Array.from(P).filter(z).forEach(A),P.clear()}),M?C:t)}function G(e){v.add(e),clearTimeout(p);p=setTimeout((()=>{Array.from(v).filter(z).forEach(F),v.clear()}),M?C:t)}function J(e){N.add(e),clearTimeout(T);T=setTimeout((()=>{Array.from(N).filter(z).forEach(I),N.clear()}),M?C:t)}function K(e){w.add(e),clearTimeout(b);b=setTimeout((()=>{Array.from(w).filter(z).forEach(_),w.clear()}),M?C:t)}function Q(e){const t=new Set,s=new Set,o=new Set,n=new Set;try{for(const c of e){if("childList"===c.type&&c.addedNodes.length>0&&c.addedNodes.forEach((e=>{1===e.nodeType&&(D.pnlContainers.forEach((s=>{try{if((e.querySelectorAll?e.querySelectorAll(s):[]).forEach((e=>{const s=B(e,D.truncateElements);s&&s.textContent.includes("USDT")&&t.add(e)})),e.matches&&e.matches(s)){const s=B(e,D.truncateElements);s&&s.textContent.includes("USDT")&&t.add(e)}}catch(e){}})),D.mobilePnlElements.forEach((t=>{try{if((e.querySelectorAll?e.querySelectorAll(t):[]).forEach((e=>{if(e.textContent.trim().match(/^[+-]?[\d,]+\.?\d*$/)&&(e.classList.contains("text-TextSell")||e.classList.contains("text-TextBuy"))){const t=e.closest(".flex.justify-between.mb-\\[8px\\]")||e.closest(".flex.justify-between");if(t){const s=t.querySelector('[class*="t-caption1"]');s&&s.textContent.includes("Unrealized PNL")&&o.add(e)}}})),e.matches&&e.matches(t)){if(e.textContent.trim().match(/^[+-]?[\d,]+\.?\d*$/)&&(e.classList.contains("text-TextSell")||e.classList.contains("text-TextBuy"))){const t=e.closest(".flex.justify-between.mb-\\[8px\\]")||e.closest(".flex.justify-between");if(t){const s=t.querySelector('[class*="t-caption1"]');s&&s.textContent.includes("Unrealized PNL")&&o.add(e)}}}}catch(e){}})),D.mobileSizeElements.forEach((t=>{try{if((e.querySelectorAll?e.querySelectorAll(t):[]).forEach((e=>{const s=e.textContent.trim();if(s.match(/^[+-]?[\d,]+\.?\d*$/)&&!e.classList.contains("text-TextSell")&&!e.classList.contains("text-TextBuy")&&e.classList.contains("t-body2")){if(e.closest(".grid.grid-cols-3")){const o=e.closest(".flex.flex-col.items-left")||e.closest(".flex.flex-col");if(o){const l=o.querySelector('[class*="t-caption1"]');l&&l.textContent.includes("Size")&&(n.add(e),console.log("PNL Modifier: Found mobile size element (node added):",{text:s,selector:t,hasLabel:!!l}))}}}})),e.matches&&e.matches(t)){const s=e.textContent.trim();if(s.match(/^[+-]?[\d,]+\.?\d*$/)&&!e.classList.contains("text-TextSell")&&!e.classList.contains("text-TextBuy")&&e.classList.contains("t-body2")){if(e.closest(".grid.grid-cols-3")){const o=e.closest(".flex.flex-col.items-left")||e.closest(".flex.flex-col");if(o){const l=o.querySelector('[class*="t-caption1"]');l&&l.textContent.includes("Size")&&(n.add(e),console.log("PNL Modifier: Found mobile size element (node itself):",{text:s,selector:t,hasLabel:!!l}))}}}}}catch(e){}})),D.sizeContainers.forEach((t=>{try{if((e.querySelectorAll?e.querySelectorAll(t):[]).forEach((e=>{const t=e.textContent.includes("USDT"),o=e.classList.contains("text-Sell")||e.classList.contains("text-Buy")||e.className.includes("text-Sell")||e.className.includes("text-Buy"),n=e.style.flex&&(e.style.flex.includes("100px")||e.style.flex.includes("100"));t&&(o||n)&&s.add(e)})),e.matches&&e.matches(t)){const t=e.textContent.includes("USDT"),o=e.classList.contains("text-Sell")||e.classList.contains("text-Buy")||e.className.includes("text-Sell")||e.className.includes("text-Buy"),n=e.style.flex&&(e.style.flex.includes("100px")||e.style.flex.includes("100"));t&&(o||n)&&s.add(e)}}catch(e){}})))})),("characterData"===c.type||"childList"===c.type)&&c.target.classList&&c.target.classList.contains("truncate")){let e=c.target;if(1!==e.nodeType&&(e=e.parentElement),e&&e.closest){const s=e.closest('div[style*="flex: 1 0 140px"]')||e.closest('div[style*="flex:1 0 140px"]');if(s){const e=B(s,D.truncateElements);if(e&&e.textContent.includes("USDT")){const o=e.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(o&&o[1]){const e=parseFloat(o[1].replace(/,/g,""));U(e,l.get(s))&&(l.set(s,e),t.add(s))}}}}}if("characterData"===c.type||"childList"===c.type){let e=c.target;if(1!==e.nodeType&&(e=e.parentElement),e&&e.classList&&(e.classList.contains("text-TextSell")||e.classList.contains("text-TextBuy"))&&e.classList.contains("t-body2")){const t=e.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(t&&t[1]){const s=e.closest(".flex.justify-between.mb-\\[8px\\]")||e.closest(".flex.justify-between");if(s){const n=s.querySelector('[class*="t-caption1"]');if(n&&n.textContent.includes("Unrealized PNL")){const s=parseFloat(t[1].replace(/,/g,""));U(s,l.get(e))&&(l.set(e,s),o.add(e))}}}}}if("characterData"===c.type||"childList"===c.type){let e=c.target;if(1!==e.nodeType&&(e=e.parentElement),e&&e.classList&&e.classList.contains("t-body2")&&!e.classList.contains("text-TextSell")&&!e.classList.contains("text-TextBuy")){const t=e.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(t&&t[1]){const s=e.closest(".grid.grid-cols-3"),o=s?.querySelector('[class*="t-caption1"]');if(o&&o.textContent.includes("Size")){const s=parseFloat(t[1].replace(/,/g,""));q(s,u.get(e))&&(u.set(e,s),n.add(e))}}}}if("characterData"===c.type||"childList"===c.type){let e=c.target;if(1!==e.nodeType&&(e=e.parentElement),e&&e.style){const t=e.style.flex,o="1 0 100px"===t||"1 0 100px"===t||"1 0 100"===t||"1 0 100px"===t||t.includes("100px")||t.includes("100"),n=e.textContent.includes("USDT"),l=e.classList.contains("text-Sell")||e.classList.contains("text-Buy")||e.className.includes("text-Sell")||e.className.includes("text-Buy");if(o&&n&&l){const t=e.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(t&&t[1]){const o=parseFloat(t[1].replace(/,/g,""));q(o,r.get(e))&&(r.set(e,o),s.add(e))}}}if(e&&e.querySelector){const t=e.querySelector('[class*="text-"][style*="flex"]')||e.querySelector('[style*="100px"]');if(t&&t.textContent.includes("USDT")&&(t.classList.contains("text-Sell")||t.classList.contains("text-Buy"))){const e=t.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(e&&e[1]){const o=parseFloat(e[1].replace(/,/g,""));q(o,r.get(t))&&(r.set(t,o),s.add(t))}}}}}t.forEach((e=>R(e))),o.forEach((e=>G(e))),s.forEach((e=>K(e))),n.forEach((e=>J(e)))}catch(e){console.warn("PNL Modifier: Error handling mutations:",e)}}function X(){try{document.querySelectorAll('div[style*="flex: 1 0 140px"], div[style*="flex:1 0 140px"]').forEach((e=>{if(z(e)){const t=B(e,D.truncateElements);t&&t.textContent.includes("USDT")&&!c.has(t)&&R(e)}})),D.mobilePnlElements.forEach((e=>{try{document.querySelectorAll(e).forEach((t=>{if(z(t)){const s=t.textContent.trim();if(s.match(/^[+-]?[\d,]+\.?\d*$/)&&(t.classList.contains("text-TextSell")||t.classList.contains("text-TextBuy"))&&!c.has(t)){const o=t.closest(".flex.justify-between.mb-\\[8px\\]")||t.closest(".flex.justify-between");if(o){const n=o.querySelector('[class*="t-caption1"]');n&&n.textContent.includes("Unrealized PNL")&&(M&&console.log("PNL Modifier (macOS): Scheduling mobile PNL update for:",{text:s,selector:e,classes:t.className,hasTextSell:t.classList.contains("text-TextSell"),hasTextBuy:t.classList.contains("text-TextBuy")}),G(t))}}}}))}catch(t){M&&console.warn("PNL Modifier (macOS): Mobile PNL selector failed:",e,t)}})),D.mobileSizeElements.forEach((e=>{try{document.querySelectorAll(e).forEach((t=>{if(z(t)){const s=t.textContent.trim();if(s.match(/^([+-]?[\d,]+\.?\d*)$/)&&!t.classList.contains("text-TextSell")&&!t.classList.contains("text-TextBuy")&&t.classList.contains("t-body2")&&!h.has(t)){if(t.closest(".grid.grid-cols-3")){const o=t.closest(".flex.flex-col.items-left")||t.closest(".flex.flex-col");if(o){const n=o.querySelector('[class*="t-caption1"]');n&&n.textContent.includes("Size")&&(J(t),console.log("PNL Modifier: Scheduled mobile size element update:",{text:s,selector:e,hasLabel:!!n}))}}}}}))}catch(e){}}));['div[style*="flex: 1 0 100px"]','div[style*="flex:1 0 100px"]','div[style*="flex: 1 0 100"]','div[style*="flex:1 0 100"]','[style*="100px"][class*="text-"]','[class*="text-Sell"][style*="flex"]','[class*="text-Buy"][style*="flex"]'].forEach((e=>{try{document.querySelectorAll(e).forEach((e=>{if(z(e)){const t=e.textContent.includes("USDT"),s=e.classList.contains("text-Sell")||e.classList.contains("text-Buy")||e.className.includes("text-Sell")||e.className.includes("text-Buy"),o=e.style.flex&&(e.style.flex.includes("100px")||e.style.flex.includes("100"));t&&(s||o)&&!d.has(e)&&K(e)}}))}catch(e){}}))}catch(e){console.warn("PNL Modifier: Error in performUpdates:",e)}}function Y(){try{let t=null;for(const e of D.containers)if(t=document.querySelector(e),t){console.log(`PNL Modifier: Found container with selector: ${e}`);break}t||(t=document.body,console.log("PNL Modifier: Using body as fallback container"));new MutationObserver(Q).observe(t,{childList:!0,subtree:!0,characterData:!0,attributes:!1}),X();const o={passive:!0,capture:!1};window.addEventListener("scroll",V,o),document.addEventListener("wheel",V,o);[t,...document.querySelectorAll('div[style*="overflow"]'),...document.querySelectorAll('div[style*="overflow-x"]')].filter(Boolean).forEach((e=>{e!==document.body&&e.addEventListener("scroll",V,o)})),window.addEventListener("resize",(()=>{setTimeout(X,100)}),o),setInterval((()=>{const t=Date.now();for(const[e,o]of i.entries())t-o>s&&(i.delete(e),l.delete(e));for(const[e,o]of x.entries())t-o>s&&(x.delete(e),r.delete(e));for(const[e,o]of y.entries())t-o>s&&(y.delete(e),u.delete(e));X(),document.querySelectorAll('div[style*="flex: 1 0 140px"], div[style*="flex:1 0 140px"]').forEach((t=>{const s=B(t,D.truncateElements);if(s&&l.has(t)){const o=s.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(o&&o[1]){const n=parseFloat(o[1].replace(/,/g,"")),c=l.get(t),i=c*e;if(Math.abs(n-i)>.01)if(U(n,c)){l.set(t,n);const o=n*e,c=`${o>0?"+":""}${O(o)} USDT`;s.textContent=c,s._protectionObserver&&s._protectionObserver.disconnect(),H(s,c)}else{const e=`${i>0?"+":""}${O(i)} USDT`;s.textContent=e,a.has(s)||H(s,e)}}}})),D.mobilePnlElements.forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{if(t.classList.contains("text-TextSell")&&l.has(t)){const s=t.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(s&&s[1]){const o=parseFloat(s[1].replace(/,/g,"")),n=l.get(t),c=n*e;if(Math.abs(o-c)>.01)if(U(o,n)){l.set(t,o);const s=o*e,n=`${s>0?"+":""}${O(Math.abs(s))}`;t.textContent=n,t._mobilePnlProtectionObserver&&t._mobilePnlProtectionObserver.disconnect(),W(t,n)}else{const e=`${c>0?"+":""}${O(Math.abs(c))}`;t.textContent=e,a.has(t)||W(t,e)}}}}))}catch(e){}})),D.mobileSizeElements.forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{if(!t.classList.contains("text-TextSell")&&!t.classList.contains("text-TextBuy")&&t.classList.contains("t-body2")&&u.has(t)){const s=t.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(s&&s[1]){const o=parseFloat(s[1].replace(/,/g,"")),n=u.get(t),l=n*e;if(Math.abs(o-l)>.01)if(q(o,n)){u.set(t,o);const s=o*e,n=(s<0?"-":"")+O(s).replace(/^-/,"");t.textContent=n,t._mobileSizeProtectionObserver&&t._mobileSizeProtectionObserver.disconnect(),j(t,n)}else{const e=(l<0?"-":"")+O(l).replace(/^-/,"");t.textContent=e,m.has(t)||j(t,e)}}}}))}catch(e){}}));['div[style*="flex: 1 0 100px"]','div[style*="flex:1 0 100px"]','div[style*="flex: 1 0 100"]','div[style*="flex:1 0 100"]','[style*="100px"][class*="text-"]','[class*="text-Sell"][style*="flex"]','[class*="text-Buy"][style*="flex"]'].forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{const s=t.textContent.includes("USDT"),o=t.classList.contains("text-Sell")||t.classList.contains("text-Buy")||t.className.includes("text-Sell")||t.className.includes("text-Buy"),n=t.style.flex&&(t.style.flex.includes("100px")||t.style.flex.includes("100"));if(s&&(o||n)&&r.has(t)){const s=t.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(s&&s[1]){const o=parseFloat(s[1].replace(/,/g,"")),n=r.get(t),l=n*e;if(Math.abs(o-l)>.01)if(q(o,n)){r.set(t,o);const s=o*e,n=t.classList.contains("text-Sell")||t.className.includes("text-Sell")||o<0?"-":"",l=O(Math.abs(s),!1,!0),c=`${n}${l}\nUSDT`;try{t.innerHTML=`${n}${l}<br>USDT`}catch(e){t.textContent=`${n}${l} USDT`}t._sizeProtectionObserver&&t._sizeProtectionObserver.disconnect(),k(t,c)}else{const e=t.classList.contains("text-Sell")||t.className.includes("text-Sell")||l<0?"-":"",s=O(Math.abs(l),!1,!0),o=`${e}${s}\nUSDT`;try{t.innerHTML=`${e}${s}<br>USDT`}catch(o){t.textContent=`${e}${s} USDT`}f.has(t)||k(t,o)}}}}))}catch(e){}}))}),5e3),console.log(`Ultra-Optimized PNL Modifier started successfully! (${M?"macOS":"Windows"} optimized)`),M&&setTimeout((()=>{const e=document.querySelectorAll('[style*="100px"], [class*="text-Sell"], [class*="text-Buy"]');console.log(`PNL Modifier: Found ${e.length} potential size elements on macOS`);let t=0;e.forEach((e=>{e.textContent.includes("USDT")&&(t++,console.log("PNL Modifier: Valid size element found:",{text:e.textContent.trim(),flex:e.style.flex,classes:e.className,hasUSDT:e.textContent.includes("USDT")}))})),console.log(`PNL Modifier: ${t} valid size elements with USDT found on macOS`)}),2e3),setTimeout((()=>{const e=document.querySelectorAll(".text-TextSell.t-body2");console.log(`PNL Modifier: Found ${e.length} potential mobile PNL elements`);let t=0;e.forEach((e=>{const s=e.textContent.trim();s.match(/^[+-]?[\d,]+\.?\d*$/)&&(t++,console.log("PNL Modifier: Valid mobile PNL element found:",{text:s,classes:e.className,parent:e.parentElement?e.parentElement.className:"no parent"}))})),console.log(`PNL Modifier: ${t} valid mobile PNL elements found`),M&&(console.log("PNL Modifier (macOS): Testing all mobile PNL selectors..."),D.mobilePnlElements.forEach(((e,t)=>{try{const s=document.querySelectorAll(e);console.log(`PNL Modifier (macOS): Selector ${t+1} (${e}): found ${s.length} elements`),s.forEach(((e,t)=>{const s=e.textContent.trim(),o=e.classList.contains("text-TextSell"),n=s.match(/^[+-]?[\d,]+\.?\d*$/);console.log(`  Element ${t+1}: "${s}", hasTextSell: ${o}, matchesPattern: ${!!n}`)}))}catch(t){console.warn(`PNL Modifier (macOS): Selector failed: ${e}`,t)}})));const s=document.querySelector("#POSITIONS");if(s){console.log("PNL Modifier: POSITIONS container found");const e=s.querySelectorAll(".py-\\[16px\\]");console.log(`PNL Modifier: Found ${e.length} position divs`)}else console.log("PNL Modifier: POSITIONS container NOT found")}),3e3),setTimeout((()=>{const e=document.querySelectorAll("#POSITIONS .t-body2:not(.text-TextSell)");console.log(`PNL Modifier: Found ${e.length} potential mobile size elements`);let t=0;e.forEach((e=>{const s=e.textContent.trim(),o=e.closest(".grid.grid-cols-3"),n=o?.querySelector('[class*="t-caption1"]');s.match(/^[\d,]+\.?\d*$/)&&n&&n.textContent.includes("Size")&&(t++,console.log(`Mobile Size Element: "${s}" in context: "${n.textContent}"`))})),console.log(`PNL Modifier: ${t} valid mobile size elements found`)}),4e3)}catch(e){console.error("PNL Modifier: Error during initialization:",e)}}function Z(){let e=0;const t=setInterval((()=>{e++;try{const s=document.querySelectorAll('div[style*="flex: 1 0 140px"], div[style*="flex:1 0 140px"]').length>0,o=D.containers.some((e=>document.querySelector(e))),n=document.querySelector('div[class*="bn-"]')||document.querySelector('div[class*="binance"]')||document.body.children.length>5;(s||o||n||e>=50)&&(clearInterval(t),Y(),s||o?console.log("PNL Modifier: Started successfully after "+e+" attempts"):console.log("PNL Modifier: Started in fallback mode after "+e+" attempts"))}catch(s){console.warn("PNL Modifier: Error during startup check:",s),e>=50&&(clearInterval(t),Y())}}),M?$:150)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Z):setTimeout(Z,M?300:100)}();