!function(){"use strict";const t=1e4,e=50,o=3e4,n=16,s=100,l=new Map,i=new WeakSet,c=new Map,a=new WeakSet,r=new Map,d=new WeakSet,f=new Map,x=new WeakSet,u=new Map,m=new WeakSet,h=new Map,y=new WeakSet,p=new Map,g=new WeakSet,S=new Map,b=new WeakSet,T=new Map,L=new Map,C=new WeakSet,P=new WeakMap,M=new WeakMap;let v,N,w,E,$,O,D=0,q=new Set,z=new Set,I=new Set,U=new Set,B=new Set;const F=navigator.platform.toLowerCase().includes("mac")||navigator.userAgent.toLowerCase().includes("mac")||navigator.platform.toLowerCase().includes("darwin")||/macintosh|mac os x/i.test(navigator.userAgent),A=F?75:e,R=F?250:150,_=F?25:n,k={pnlContainers:['div[style*="flex: 1 0 140px"]','div[style*="flex:1 0 140px"]','div[style*="flex: 1"]',".truncate-parent"],sizeContainers:['div[style*="flex: 1 0 100px"]','div[style*="flex:1 0 100px"]','div[style*="flex:1"]','div[style*="flex: 1 0 100"]','div[style*="flex:1 0 100"]','[style*="100px"][class*="text-"]','[class*="text-Sell"][style*="flex"]','[class*="text-Buy"][style*="flex"]','div[style*="width: 100px"][style*="flex"]','.text-Buy[style*="100px"]','.text-Sell[style*="100px"]','[style*="flex: 1"][class*="typography-caption2"]'],mobilePnlContainers:["#POSITIONS .py-\\[16px\\]",'#POSITIONS div[class*="py-[16px]"]',".py-\\[16px\\]",'[class*="py-[16px]"]'],mobilePnlElements:[".flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis.text-TextSell",".flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis.text-TextBuy",'.text-TextSell[class*="t-body2"]','.text-TextBuy[class*="t-body2"]','[class*="text-TextSell"][class*="t-body2"]','[class*="text-TextBuy"][class*="t-body2"]',".t-body2.text-TextSell",".t-body2.text-TextBuy",".text-TextSell.t-body2",".text-TextBuy.t-body2",'div.text-TextSell[class*="t-body2"]','div.text-TextBuy[class*="t-body2"]','[class="flex text-PrimaryText t-body2 whitespace-nowrap overflow-hidden text-ellipsis text-TextSell"]','[class="flex text-PrimaryText t-body2 whitespace-nowrap overflow-hidden text-ellipsis text-TextBuy"]'],mobileSizeContainers:["#POSITIONS .grid.grid-cols-3.gap-\\[8px\\].mb-\\[8px\\]",'#POSITIONS div[class*="grid-cols-3"]',".grid.grid-cols-3",'[class*="grid-cols-3"]'],mobileSizeElements:[".flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis:not(.text-TextSell):not(.text-TextBuy)","#POSITIONS .flex.flex-col.items-left .flex.text-PrimaryText.t-body2",".grid-cols-3 .flex.flex-col.items-left .flex.text-PrimaryText.t-body2",".flex.flex-col.items-left .t-body2:not(.text-TextSell):not(.text-TextBuy)",".grid-cols-3 .flex.text-PrimaryText.t-body2:not(.text-TextSell):not(.text-TextBuy)","#POSITIONS .grid .flex.text-PrimaryText.t-body2:not(.text-TextSell):not(.text-TextBuy)","#POSITIONS .grid.grid-cols-3 .flex.flex-col.items-left .flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis",".grid.grid-cols-3.gap-\\[8px\\].mb-\\[8px\\] .flex.flex-col.items-left .flex.text-PrimaryText.t-body2.whitespace-nowrap.overflow-hidden.text-ellipsis"],mobileMarginElements:["#POSITIONS .grid.grid-cols-3 .flex.flex-col:not(.items-left):not(.items-end) .flex.text-PrimaryText.t-body2",".grid.grid-cols-3 .flex.flex-col:not(.items-left):not(.items-end) .t-body2","#POSITIONS .grid-cols-3 > div:nth-child(2) .t-body2",".grid-cols-3 .flex.flex-col:not([class*='items-']) .text-PrimaryText.t-body2"],roiElements:[".t-caption1.text-TextSell",".t-caption1.text-TextBuy",'[class*="t-caption1"][class*="text-TextSell"]','[class*="t-caption1"][class*="text-TextBuy"]',".text-TextSell.t-caption1",".text-TextBuy.t-caption1",'[class*="typography-caption"][class*="text-Sell"]','[class*="typography-caption"][class*="text-Buy"]',".typography-caption2.text-Sell",".typography-caption2.text-Buy"],positionCards:["#POSITIONS .py-\\[16px\\]",'#POSITIONS div[class*="py-[16px]"]',".py-\\[16px\\]",'[class*="py-[16px]"]','[class*="position-card"]',"[data-position-card]"],containers:[".fixed-size-list",".list-container",'[id*="position"]',"#POSITIONS",'[class*="position"]','div[style*="overflow: auto"]','div[style*="overflow-x: auto"]','div[style*="overflow:auto"]','div[style*="overflow-x:auto"]'],truncateElements:[".truncate",".text-truncate",'[class*="truncate"]']};function V(t,e="pnl"){const o=Math.abs(t),n=Math.floor(o),s={pnl:31,margin:37,size:41},l=31===s[e]?53:37===s[e]?59:67,i=17*(n*(s[e]||31)^n>>5)%100,c=(Math.floor(n/100)*l^255&n)+n%23,a=(13*c^c>>3)%100,r=100*Math.floor(n/100)+i,d=a.toString().padStart(2,"0");return`${r.toLocaleString("en-US")}.${d}`}function W(e,o){if(!o)return!0;const n=o*t,s=Math.abs(e);return s<=.2*Math.abs(n)&&s>.01}function H(e,o){if(!o)return!0;const n=o*t,s=Math.abs(e);return s<=.2*Math.abs(n)&&s>.01}function j(t){try{if(!t||!document.body.contains(t))return!1;const e=t.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth,s=F?10:5;return e.top>=-s&&e.left>=-s&&e.bottom<=o+s&&e.right<=n+s&&e.width>0&&e.height>0}catch(t){return console.warn("PNL Modifier: Error checking viewport:",t),!1}}function G(t,e){for(const o of e)try{const e=t.querySelector(o);if(e)return e}catch(t){continue}return null}function K(t){try{const e=t.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*%/);if(e&&e[1]){const t=parseFloat(e[1].replace(/,/g,""));if(!isNaN(t))return t/100}return null}catch(t){return console.warn("PNL Modifier: Error extracting ROI:",t),null}}function J(t){try{if(!t||!document.body.contains(t))return;let e=null;k.roiElements.forEach((o=>{if(!e){const n=t.querySelector(o);n&&n.textContent.includes("%")&&(e=n)}}));let o=null;k.mobileMarginElements.forEach((e=>{if(!o){const n=t.querySelector(e);if(n){const t=n.closest(".flex.flex-col"),e=t?.querySelector('[class*="t-caption1"]');e&&e.textContent.includes("Margin")&&(o=n)}}}));let n=null;k.mobilePnlElements.forEach((e=>{if(!n){t.querySelectorAll(e).forEach((t=>{t.closest(".grid-cols-3")||(n=t)}))}}));let s=null;if(k.mobileSizeElements.forEach((e=>{if(!s){const o=t.querySelector(e);if(o){const t=o.closest(".flex.flex-col.items-left"),e=t?.querySelector('[class*="t-caption1"]');e&&e.textContent.includes("Size")&&(s=o)}}})),e&&o&&n){const l={card:t,roi:e,margin:o,pnl:n,size:s};L.set(t,l),P.set(n,t),M.set(e,t),function(t,e){if(C.has(t))return;C.add(t);const o=new MutationObserver((o=>{o.forEach((o=>{if("characterData"===o.type||"childList"===o.type)try{const o=K(t);if(null!==o){const n=T.get(t);(void 0===n||Math.abs(o-n)>1e-4)&&(T.set(t,o),t.dataset.originalRoi=o.toString(),Q(e))}}catch(t){console.warn("PNL Modifier: Error in ROI observer:",t)}}))}));o.observe(t,{characterData:!0,childList:!0,subtree:!0}),t._roiObserver=o;const n=K(t);null!==n&&(T.set(t,n),t.dataset.originalRoi=n.toString())}(e,t),console.log("PNL Modifier: Linked position card:",{hasROI:!!e,hasMargin:!!o,hasPNL:!!n,hasSize:!!s,roiText:e?.textContent,marginText:o?.textContent})}}catch(t){console.warn("PNL Modifier: Error linking position card:",t)}}function Q(e){try{const o=L.get(e);if(!o)return;const{roi:n,margin:s,pnl:a}=o;if(!n||!s||!a)return;let r=T.get(n);if(void 0===r||isNaN(r)){if(r=K(n),null===r)return;T.set(n,r),n.dataset.originalRoi=r.toString()}let d=p.get(s);if(void 0===d)if(s.dataset.originalMargin)d=parseFloat(s.dataset.originalMargin),p.set(s,d);else{let e="";e=s.firstChild&&3===s.firstChild.nodeType?s.firstChild.nodeValue.trim():s.textContent.trim();const o=e.match(/^([+-]?[\d,]+\.?\d*)$/);if(!o||!o[1])return void console.error("PNL Modifier: Cannot extract margin - cache miss and parse failed");const n=parseFloat(o[1].replace(/,/g,""));n>1e4?(d=n/t,console.warn("PNL Modifier: Margin cache miss - dividing displayed value (may be inaccurate due to randomization)")):d=n,p.set(s,d),s.dataset.originalMargin=d.toString()}if(isNaN(d))return void console.error("PNL Modifier: Invalid original margin value");const f=function(t,e){return t*e}(r,d),x=f*t,u=`${x>0?"+":""}${V(Math.abs(x),"pnl")}`;if(a.textContent!==u){const t=a._mobilePnlProtectionObserver;t&&t.disconnect(),a._updatingFromRoi=!0,a.textContent=u,l.set(a,f),a.dataset.originalPnl=f.toString(),i.add(a),c.set(a,Date.now()),Promise.resolve().then((()=>{if(a._updatingFromRoi=!1,t)try{t.observe(a,{characterData:!0,childList:!0,subtree:!0})}catch(t){}})),console.log("PNL Modifier: Updated PNL from ROI (optimized):",{roi:`${(100*r).toFixed(2)}%`,margin:d.toFixed(2),calculatedPnl:f.toFixed(2),displayedPnl:u})}}catch(t){console.warn("PNL Modifier: Error updating PNL from ROI:",t)}}function X(e){try{if(!document.body.contains(e)||null===e.offsetParent)return;const o=G(e,k.truncateElements);if(!o)return;const n=o.textContent.trim(),s=n.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(s&&s[1]){let r;l.has(e)?r=l.get(e):(r=parseFloat(s[1].replace(/,/g,"")),l.set(e,r),o.dataset.originalText=n,o.dataset.originalPnl=r.toString(),e.dataset.originalPnl=r.toString());const d=r*t,f=`${d>0?"+":d<0?"-":""}${V(Math.abs(d),"pnl")} USDT`;o.textContent!==f&&(o.textContent=f,i.add(o),a.add(o),c.set(e,Date.now()),nt(o,f))}}catch(t){console.warn("PNL Modifier: Error processing PNL element:",t)}}function Y(e){try{if(!document.body.contains(e)||null===e.offsetParent)return;const o=P.get(e);if(o)return void Q(o);const n=e.textContent.trim(),s=n.match(/^([+-]?[\d,]+\.?\d*)$/);if(s&&s[1]){let o;l.has(e)?o=l.get(e):(o=parseFloat(s[1].replace(/,/g,"")),l.set(e,o),e.dataset.originalText=n,e.dataset.originalPnl=o.toString(),F&&console.log("PNL Modifier (macOS): Found mobile PNL element (no ROI):",{text:n,originalValue:o,classes:e.className,hasTextSell:e.classList.contains("text-TextSell"),hasTextBuy:e.classList.contains("text-TextBuy")}));const r=o*t,d=`${r>0?"+":""}${V(Math.abs(r),"pnl")}`;e.textContent!==d&&(e.textContent=d,i.add(e),a.add(e),c.set(e,Date.now()),st(e,d),F&&console.log("PNL Modifier (macOS): Updated mobile PNL element (no ROI):",{original:n,modified:d,multiplier:t}))}}catch(t){console.warn("PNL Modifier: Error processing mobile PNL element:",t)}}function Z(e){try{if(!document.body.contains(e)||null===e.offsetParent)return;const o=e.textContent.trim(),n=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(n&&n[1]){let s;u.has(e)?s=u.get(e):(s=parseFloat(n[1].replace(/,/g,"")),u.set(e,s),e.dataset.originalText=o,e.dataset.originalSize=s.toString(),console.log("PNL Modifier: Found mobile size element:",{text:o,originalValue:s,classes:e.className,isNegative:s<0}));const l=s*t,i=`${l<0?"-":""}${V(Math.abs(l),"size")}`;e.textContent!==i&&(e.textContent=i,m.add(e),y.add(e),h.set(e,Date.now()),lt(e,i),console.log("PNL Modifier: Updated mobile size element:",{original:o,modified:i,wasNegative:s<0}))}}catch(t){console.warn("PNL Modifier: Error processing mobile size element:",t)}}function tt(e){try{if(!document.body.contains(e)||null===e.offsetParent)return;let o="";o=e.firstChild&&3===e.firstChild.nodeType?e.firstChild.nodeValue.trim():e.textContent.trim();const n=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(n&&n[1]){let o;if(p.has(e))o=p.get(e);else{const t=parseFloat(n[1].replace(/,/g,""));if(isNaN(t)||0===t)return;const s=e.closest(".flex.flex-col");if(!s)return;const l=s.querySelector('[class*="t-caption1"]');if(!l||!l.textContent.includes("Margin"))return;o=t,p.set(e,o),e.dataset.originalText=n[1],e.dataset.originalMargin=o.toString()}const s=o*t,l=`${s<0?"-":""}${V(Math.abs(s),"margin")}`;if(e.firstChild&&3===e.firstChild.nodeType)e.firstChild.nodeValue.trim()!==l&&(e.firstChild.nodeValue=l,g.add(e),b.add(e),S.set(e,Date.now()),it(e,l));else if(e.textContent.trim()!==l){const t=e.querySelector("svg");e.textContent=l,t&&e.appendChild(t),g.add(e),b.add(e),S.set(e,Date.now()),it(e,l)}}}catch(t){console.warn("PNL Modifier: Error processing mobile margin element:",t)}}function et(e){try{if(!document.body.contains(e)||null===e.offsetParent)return;let o=e.textContent.trim();if(!o.includes("USDT")&&e.querySelector){const t=e.querySelector('[class*="text-"]')||e.querySelector('*[text*="USDT"]')||e.querySelector("span, div");t&&(o=t.textContent.trim())}const n=o.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(n&&n[1]){let s;r.has(e)?s=r.get(e):(s=parseFloat(n[1].replace(/,/g,"")),r.set(e,s),e.dataset.originalText=o,e.dataset.originalSize=s.toString());const l=s*t,i=e.classList.contains("text-Sell")||e.className.includes("text-Sell")||s<0?"-":"",c=V(Math.abs(l),"size"),a=`${i}${c}\nUSDT`;if(e.textContent.replace(/\s+/g," ").trim()!==a.replace(/[\n\r]/g," ").trim()){try{e.innerHTML=`${i}${c}<br>USDT`}catch(t){e.textContent=`${i}${c} USDT`}d.add(e),x.add(e),f.set(e,Date.now()),ot(e,a),setTimeout((()=>{if(e.textContent&&!e.textContent.includes(c)){console.warn("PNL Modifier: Size update verification failed, retrying...");try{e.innerHTML=`${i}${c}<br>USDT`}catch(t){e.textContent=`${i}${c} USDT`}}}),50)}}}catch(t){console.warn("PNL Modifier: Error processing size element:",t)}}function ot(e,o){if(!x.has(e))return;const n=new MutationObserver((n=>{n.forEach((n=>{if("characterData"===n.type||"childList"===n.type)try{let n=e.textContent.trim();if(!n.includes("USDT")&&e.querySelector){const t=e.querySelector("*");t&&(n=t.textContent.trim())}const s=n.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(!s||!s[1])return;const l=parseFloat(s[1].replace(/,/g,"")),i=o.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(!i||!i[1])return;const c=parseFloat(i[1].replace(/,/g,""));if(Math.abs(l-c)>.01){if(H(l,r.get(e))){r.set(e,l);const o=l*t,n=e.classList.contains("text-Sell")||e.className.includes("text-Sell")||l<0?"-":"",s=V(Math.abs(o),"size"),i=`${n}${s}\nUSDT`;try{e.innerHTML=`${n}${s}<br>USDT`}catch(t){e.textContent=`${n}${s} USDT`}return e._sizeProtectionObserver&&e._sizeProtectionObserver.disconnect(),void ot(e,i)}try{o.includes("\n")?e.innerHTML=o.replace("\n","<br>"):e.innerHTML=o}catch(t){e.textContent=o.replace("\n"," ")}setTimeout((()=>{if(!e.textContent.trim().includes(i[1]))try{e.innerHTML=o.replace("\n","<br>")}catch(t){e.textContent=o.replace("\n"," ")}}),25)}}catch(t){console.warn("PNL Modifier: Error in size protection:",t)}}))}));n.observe(e,{characterData:!0,childList:!0,subtree:!0}),e._sizeProtectionObserver=n}function nt(e,o){if(!a.has(e))return;const n=new MutationObserver((n=>{n.forEach((n=>{if("characterData"===n.type||"childList"===n.type)try{const n=e.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(!n||!n[1])return;const s=parseFloat(n[1].replace(/,/g,"")),i=o.match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(!i||!i[1])return;const c=parseFloat(i[1].replace(/,/g,""));if(Math.abs(s-c)>.01){const n=e.closest('div[style*="flex: 1 0 140px"]')||e.closest('div[style*="flex:1 0 140px"]');if(n&&W(s,l.get(n))){l.set(n,s);const o=s*t,i=`${o>0?"+":o<0?"-":""}${V(Math.abs(o),"pnl")} USDT`;return e.textContent=i,e._protectionObserver&&e._protectionObserver.disconnect(),void nt(e,i)}e.textContent=o}}catch(t){console.warn("PNL Modifier: Error in PNL protection:",t)}}))}));n.observe(e,{characterData:!0,childList:!0,subtree:!0}),e._protectionObserver=n}function st(e,o){if(!a.has(e))return;const n=new MutationObserver((n=>{n.forEach((n=>{if(("characterData"===n.type||"childList"===n.type)&&!e._updatingFromRoi)try{const n=e.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(!n||!n[1])return;const s=parseFloat(n[1].replace(/,/g,"")),i=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(!i||!i[1])return;const c=parseFloat(i[1].replace(/,/g,""));if(Math.abs(s-c)>.01){if(W(s,l.get(e))){l.set(e,s);const o=s*t,n=`${o>0?"+":o<0?"-":""}${V(Math.abs(o),"pnl")}`;return e.textContent=n,e._mobilePnlProtectionObserver&&e._mobilePnlProtectionObserver.disconnect(),void st(e,n)}e.textContent=o}}catch(t){console.warn("PNL Modifier: Error in mobile PNL protection:",t)}}))}));n.observe(e,{characterData:!0,childList:!0,subtree:!0}),e._mobilePnlProtectionObserver=n}function lt(e,o){if(!y.has(e))return;const n=new MutationObserver((n=>{n.forEach((n=>{if("characterData"===n.type||"childList"===n.type)try{const n=e.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(!n||!n[1])return;const s=parseFloat(n[1].replace(/,/g,"")),l=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(!l||!l[1])return;const i=parseFloat(l[1].replace(/,/g,""));if(Math.abs(s-i)>.01){if(H(s,u.get(e))){u.set(e,s);const o=s*t,n=`${o<0?"-":""}${V(Math.abs(o),"size")}`;return e.textContent=n,e._mobileSizeProtectionObserver&&e._mobileSizeProtectionObserver.disconnect(),void lt(e,n)}e.textContent=o}}catch(t){console.warn("PNL Modifier: Error in mobile size protection:",t)}}))}));n.observe(e,{characterData:!0,childList:!0,subtree:!0}),e._mobileSizeProtectionObserver=n}function it(e,o){if(!b.has(e))return;const n=new MutationObserver((n=>{n.forEach((n=>{try{let n="";if(n=e.firstChild&&3===e.firstChild.nodeType?e.firstChild.nodeValue.trim():e.textContent.trim(),n!==o&&n.match(/^[\d,]+\.?\d*$/)){const s=parseFloat(n.replace(/,/g,"")),l=p.get(e);if(l&&H(s,l)){p.set(e,s);const o=s*t,n=`${o<0?"-":""}${V(Math.abs(o),"margin")}`;if(e.firstChild&&3===e.firstChild.nodeType)e.firstChild.nodeValue=n;else{const t=e.querySelector("svg");e.textContent=n,t&&e.appendChild(t)}S.set(e,Date.now())}else if(e.firstChild&&3===e.firstChild.nodeType)e.firstChild.nodeValue=o;else{const t=e.querySelector("svg");e.textContent=o,t&&e.appendChild(t)}}}catch(t){console.warn("PNL Modifier: Error in mobile margin protection:",t)}}))}));n.observe(e,{characterData:!0,childList:!0,subtree:!0}),e._mobileMarginProtectionObserver=n}function ct(){const t=Date.now();t-D<(F?_:n)||(D=t,clearTimeout(O),O=setTimeout((()=>{mt()}),F?1.5*s:s))}function at(t){q.add(t),clearTimeout(v),v=setTimeout((()=>{Array.from(q).filter(j).forEach(X),q.clear()}),F?A:e)}function rt(t){z.add(t),clearTimeout(N),N=setTimeout((()=>{Array.from(z).filter(j).forEach(Y),z.clear()}),F?A:e)}function dt(t){U.add(t),clearTimeout(E),E=setTimeout((()=>{Array.from(U).filter(j).forEach(Z),U.clear()}),F?A:e)}function ft(t){I.add(t),clearTimeout(w),w=setTimeout((()=>{Array.from(I).filter(j).forEach(et),I.clear()}),F?A:e)}function xt(t){B.add(t),clearTimeout($),$=setTimeout((()=>{Array.from(B).filter(j).forEach(tt),B.clear()}),F?A:e)}function ut(t){const e=new Set,o=new Set,n=new Set,s=new Set,i=new Set;try{for(const c of t){if("childList"===c.type&&c.addedNodes.length>0&&c.addedNodes.forEach((t=>{1===t.nodeType&&(k.positionCards.forEach((e=>{try{(t.querySelectorAll?t.querySelectorAll(e):[]).forEach((t=>{L.has(t)||J(t)})),t.matches&&t.matches(e)&&!L.has(t)&&J(t)}catch(t){}})),k.pnlContainers.forEach((o=>{try{if((t.querySelectorAll?t.querySelectorAll(o):[]).forEach((t=>{const o=G(t,k.truncateElements);o&&o.textContent.includes("USDT")&&e.add(t)})),t.matches&&t.matches(o)){const o=G(t,k.truncateElements);o&&o.textContent.includes("USDT")&&e.add(t)}}catch(t){}})),k.mobilePnlElements.forEach((e=>{try{if((t.querySelectorAll?t.querySelectorAll(e):[]).forEach((t=>{if(t.textContent.trim().match(/^[+-]?[\d,]+\.?\d*$/)&&(t.classList.contains("text-TextSell")||t.classList.contains("text-TextBuy"))){const e=t.closest(".flex.justify-between.mb-\\[8px\\]")||t.closest(".flex.justify-between");if(e){const o=e.querySelector('[class*="t-caption1"]');o&&o.textContent.includes("Unrealized PNL")&&n.add(t)}}})),t.matches&&t.matches(e)&&t.textContent.trim().match(/^[+-]?[\d,]+\.?\d*$/)&&(t.classList.contains("text-TextSell")||t.classList.contains("text-TextBuy"))){const e=t.closest(".flex.justify-between.mb-\\[8px\\]")||t.closest(".flex.justify-between");if(e){const o=e.querySelector('[class*="t-caption1"]');o&&o.textContent.includes("Unrealized PNL")&&n.add(t)}}}catch(t){}})),k.mobileSizeElements.forEach((e=>{try{if((t.querySelectorAll?t.querySelectorAll(e):[]).forEach((t=>{const o=t.textContent.trim();if(o.match(/^[+-]?[\d,]+\.?\d*$/)&&!t.classList.contains("text-TextSell")&&!t.classList.contains("text-TextBuy")&&t.classList.contains("t-body2")&&t.closest(".grid.grid-cols-3")){const n=t.closest(".flex.flex-col.items-left")||t.closest(".flex.flex-col");if(n){const l=n.querySelector('[class*="t-caption1"]');l&&l.textContent.includes("Size")?(s.add(t),console.log("PNL Modifier: Found mobile size element (node added):",{text:o,selector:e,hasLabel:!!l})):l&&l.textContent.includes("Margin")&&(i.add(t),console.log("PNL Modifier: Found mobile margin element (node added):",{text:o,selector:e,hasLabel:!!l}))}}})),t.matches&&t.matches(e)){const o=t.textContent.trim();if(o.match(/^[+-]?[\d,]+\.?\d*$/)&&!t.classList.contains("text-TextSell")&&!t.classList.contains("text-TextBuy")&&t.classList.contains("t-body2")&&t.closest(".grid.grid-cols-3")){const n=t.closest(".flex.flex-col.items-left")||t.closest(".flex.flex-col");if(n){const l=n.querySelector('[class*="t-caption1"]');l&&l.textContent.includes("Size")?(s.add(t),console.log("PNL Modifier: Found mobile size element (node itself):",{text:o,selector:e,hasLabel:!!l})):l&&l.textContent.includes("Margin")&&(i.add(t),console.log("PNL Modifier: Found mobile margin element (node itself):",{text:o,selector:e,hasLabel:!!l}))}}}}catch(t){}})),k.sizeContainers.forEach((e=>{try{if((t.querySelectorAll?t.querySelectorAll(e):[]).forEach((t=>{const e=t.textContent.includes("USDT"),n=t.classList.contains("text-Sell")||t.classList.contains("text-Buy")||t.className.includes("text-Sell")||t.className.includes("text-Buy"),s=t.style.flex&&(t.style.flex.includes("100px")||t.style.flex.includes("100"));e&&(n||s)&&o.add(t)})),t.matches&&t.matches(e)){const e=t.textContent.includes("USDT"),n=t.classList.contains("text-Sell")||t.classList.contains("text-Buy")||t.className.includes("text-Sell")||t.className.includes("text-Buy"),s=t.style.flex&&(t.style.flex.includes("100px")||t.style.flex.includes("100"));e&&(n||s)&&o.add(t)}}catch(t){}})))})),("characterData"===c.type||"childList"===c.type)&&c.target.classList&&c.target.classList.contains("truncate")){let t=c.target;if(1!==t.nodeType&&(t=t.parentElement),t&&t.closest){const o=t.closest('div[style*="flex: 1 0 140px"]')||t.closest('div[style*="flex:1 0 140px"]');if(o){const t=G(o,k.truncateElements);if(t&&t.textContent.includes("USDT")){const n=t.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(n&&n[1]){const t=parseFloat(n[1].replace(/,/g,""));W(t,l.get(o))&&(l.set(o,t),e.add(o))}}}}}if("characterData"===c.type||"childList"===c.type){let t=c.target;if(1!==t.nodeType&&(t=t.parentElement),t&&t.classList&&(t.classList.contains("text-TextSell")||t.classList.contains("text-TextBuy"))&&t.classList.contains("t-body2")){const e=t.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(e&&e[1]){const o=t.closest(".flex.justify-between.mb-\\[8px\\]")||t.closest(".flex.justify-between");if(o){const s=o.querySelector('[class*="t-caption1"]');if(s&&s.textContent.includes("Unrealized PNL")){const o=parseFloat(e[1].replace(/,/g,""));W(o,l.get(t))&&(l.set(t,o),n.add(t))}}}}}if("characterData"===c.type||"childList"===c.type){let t=c.target;if(1!==t.nodeType&&(t=t.parentElement),t&&t.classList&&t.classList.contains("t-body2")&&!t.classList.contains("text-TextSell")&&!t.classList.contains("text-TextBuy")){const e=t.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(e&&e[1]){const o=t.closest(".grid.grid-cols-3"),n=o?.querySelector('[class*="t-caption1"]');if(n&&n.textContent.includes("Size")){const o=parseFloat(e[1].replace(/,/g,""));H(o,u.get(t))&&(u.set(t,o),s.add(t))}}}}if("characterData"===c.type||"childList"===c.type){let t=c.target;if(1!==t.nodeType&&(t=t.parentElement),t&&t.style){const e=t.style.flex,n="1 0 100px"===e||"1 0 100px"===e||"1 0 100"===e||"1 0 100px"===e||e.includes("100px")||e.includes("100"),s=t.textContent.includes("USDT"),l=t.classList.contains("text-Sell")||t.classList.contains("text-Buy")||t.className.includes("text-Sell")||t.className.includes("text-Buy");if(n&&s&&l){const e=t.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(e&&e[1]){const n=parseFloat(e[1].replace(/,/g,""));H(n,r.get(t))&&(r.set(t,n),o.add(t))}}if(t.querySelector){const e=t.querySelector('[class*="text-"][style*="flex"]')||t.querySelector('[style*="100px"]');if(e&&e.textContent.includes("USDT")&&(e.classList.contains("text-Sell")||e.classList.contains("text-Buy"))){const t=e.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(t&&t[1]){const n=parseFloat(t[1].replace(/,/g,""));H(n,r.get(e))&&(r.set(e,n),o.add(e))}}}}}if("characterData"===c.type||"childList"===c.type){let t=c.target;if(1!==t.nodeType&&(t=t.parentElement),t&&t.classList&&t.textContent.includes("%")&&(t.classList.contains("text-TextSell")||t.classList.contains("text-TextBuy"))&&(t.classList.contains("t-caption1")||t.classList.contains("typography-caption2"))){const e=M.get(t);if(e){const o=K(t);if(null!==o){const n=T.get(t);(void 0===n||Math.abs(o-n)>1e-4)&&(T.set(t,o),Q(e),console.log("PNL Modifier: ROI changed, recalculating PNL:",{oldRoi:n?`${(100*n).toFixed(2)}%`:"initial",newRoi:`${(100*o).toFixed(2)}%`}))}}}}}e.forEach((t=>at(t))),n.forEach((t=>rt(t))),o.forEach((t=>ft(t))),s.forEach((t=>dt(t))),i.forEach((t=>xt(t)))}catch(t){console.warn("PNL Modifier: Error handling mutations:",t)}}function mt(){try{k.positionCards.forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{j(t)&&!L.has(t)&&J(t)}))}catch(t){}})),document.querySelectorAll('div[style*="flex: 1 0 140px"], div[style*="flex:1 0 140px"]').forEach((t=>{if(j(t)){const e=G(t,k.truncateElements);e&&e.textContent.includes("USDT")&&!i.has(e)&&at(t)}})),k.mobilePnlElements.forEach((t=>{try{document.querySelectorAll(t).forEach((e=>{if(j(e)){const o=e.textContent.trim();if(o.match(/^[+-]?[\d,]+\.?\d*$/)&&(e.classList.contains("text-TextSell")||e.classList.contains("text-TextBuy"))&&!i.has(e)){const n=e.closest(".flex.justify-between.mb-\\[8px\\]")||e.closest(".flex.justify-between");if(n){const s=n.querySelector('[class*="t-caption1"]');s&&s.textContent.includes("Unrealized PNL")&&(F&&console.log("PNL Modifier (macOS): Scheduling mobile PNL update for:",{text:o,selector:t,classes:e.className,hasTextSell:e.classList.contains("text-TextSell"),hasTextBuy:e.classList.contains("text-TextBuy")}),rt(e))}}}}))}catch(e){F&&console.warn("PNL Modifier (macOS): Mobile PNL selector failed:",t,e)}})),k.mobileSizeElements.forEach((t=>{try{document.querySelectorAll(t).forEach((e=>{if(j(e)){const o=e.textContent.trim();if(o.match(/^([+-]?[\d,]+\.?\d*)$/)&&!e.classList.contains("text-TextSell")&&!e.classList.contains("text-TextBuy")&&e.classList.contains("t-body2")&&!m.has(e)&&e.closest(".grid.grid-cols-3")){const n=e.closest(".flex.flex-col.items-left")||e.closest(".flex.flex-col");if(n){const s=n.querySelector('[class*="t-caption1"]');s&&s.textContent.includes("Size")&&(dt(e),console.log("PNL Modifier: Scheduled mobile size element update:",{text:o,selector:t,hasLabel:!!s}))}}}}))}catch(t){}})),k.mobileMarginElements.forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{if(!t.classList.contains("text-TextSell")&&!t.classList.contains("text-TextBuy")&&t.classList.contains("t-body2")&&!g.has(t)&&j(t)){const e=t.closest(".flex.flex-col");if(e){const o=e.querySelector('[class*="t-caption1"]');if(o&&o.textContent.includes("Margin")){(t.firstChild?.nodeValue?.trim()||t.textContent.trim()).match(/^[\d,]+\.?\d*$/)&&xt(t)}}}}))}catch(t){}})),['div[style*="flex: 1 0 100px"]','div[style*="flex:1 0 100px"]','div[style*="flex: 1 0 100"]','div[style*="flex:1 0 100"]','[style*="100px"][class*="text-"]','[class*="text-Sell"][style*="flex"]','[class*="text-Buy"][style*="flex"]'].forEach((t=>{try{document.querySelectorAll(t).forEach((t=>{if(j(t)){const e=t.textContent.includes("USDT"),o=t.classList.contains("text-Sell")||t.classList.contains("text-Buy")||t.className.includes("text-Sell")||t.className.includes("text-Buy"),n=t.style.flex&&(t.style.flex.includes("100px")||t.style.flex.includes("100"));e&&(o||n)&&!d.has(t)&&ft(t)}}))}catch(t){}}))}catch(t){console.warn("PNL Modifier: Error in performUpdates:",t)}}function ht(){try{let e=null;for(const t of k.containers)if(e=document.querySelector(t),e){console.log(`PNL Modifier: Found container with selector: ${t}`);break}e||(e=document.body,console.log("PNL Modifier: Using body as fallback container")),new MutationObserver(ut).observe(e,{childList:!0,subtree:!0,characterData:!0,attributes:!1}),mt();const n={passive:!0,capture:!1};window.addEventListener("scroll",ct,n),document.addEventListener("wheel",ct,n),[e,...document.querySelectorAll('div[style*="overflow"]'),...document.querySelectorAll('div[style*="overflow-x"]')].filter(Boolean).forEach((t=>{t!==document.body&&t.addEventListener("scroll",ct,n)})),window.addEventListener("resize",(()=>{setTimeout(mt,100)}),n),setInterval((()=>{const e=Date.now();L.forEach(((t,e)=>{document.body.contains(e)?Q(e):L.delete(e)}));for(const[t,n]of c.entries())e-n>o&&(c.delete(t),l.delete(t));for(const[t,n]of f.entries())e-n>o&&(f.delete(t),r.delete(t));for(const[t,n]of h.entries())e-n>o&&(h.delete(t),u.delete(t));mt(),document.querySelectorAll('div[style*="flex: 1 0 140px"], div[style*="flex:1 0 140px"]').forEach((e=>{const o=G(e,k.truncateElements);if(o&&l.has(e)){const n=o.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(n&&n[1]){const s=parseFloat(n[1].replace(/,/g,"")),i=l.get(e),c=i*t;if(Math.abs(s-c)>.01)if(W(s,i)){l.set(e,s);const n=s*t,i=`${n>0?"+":""}${V(Math.abs(n),"pnl")} USDT`;o.textContent=i,o._protectionObserver&&o._protectionObserver.disconnect(),nt(o,i)}else{const t=`${c>0?"+":""}${V(Math.abs(c),"pnl")} USDT`;o.textContent=t,a.has(o)||nt(o,t)}}}})),k.mobilePnlElements.forEach((e=>{try{document.querySelectorAll(e).forEach((e=>{if(e.classList.contains("text-TextSell")&&l.has(e)){const o=e.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(o&&o[1]){const n=parseFloat(o[1].replace(/,/g,"")),s=l.get(e),i=s*t;if(Math.abs(n-i)>.01)if(W(n,s)){l.set(e,n);const o=n*t,s=`${o>0?"+":""}${V(Math.abs(o),"pnl")}`;e.textContent=s,e._mobilePnlProtectionObserver&&e._mobilePnlProtectionObserver.disconnect(),st(e,s)}else{const t=`${i>0?"+":""}${V(Math.abs(i),"pnl")}`;e.textContent=t,a.has(e)||st(e,t)}}}}))}catch(t){}})),k.mobileSizeElements.forEach((e=>{try{document.querySelectorAll(e).forEach((e=>{if(!e.classList.contains("text-TextSell")&&!e.classList.contains("text-TextBuy")&&e.classList.contains("t-body2")&&u.has(e)){const o=e.textContent.trim().match(/^([+-]?[\d,]+\.?\d*)$/);if(o&&o[1]){const n=parseFloat(o[1].replace(/,/g,"")),s=u.get(e),l=s*t;if(Math.abs(n-l)>.01)if(H(n,s)){u.set(e,n);const o=n*t,s=(o<0?"-":"")+V(Math.abs(o),"size");e.textContent=s,e._mobileSizeProtectionObserver&&e._mobileSizeProtectionObserver.disconnect(),lt(e,s)}else{const t=(l<0?"-":"")+V(Math.abs(l),"size");e.textContent=t,y.has(e)||lt(e,t)}}}}))}catch(t){}})),k.mobileMarginElements.forEach((e=>{try{document.querySelectorAll(e).forEach((e=>{if(!e.classList.contains("text-TextSell")&&!e.classList.contains("text-TextBuy")&&e.classList.contains("t-body2")&&p.has(e)){let o="";o=e.firstChild&&3===e.firstChild.nodeType?e.firstChild.nodeValue.trim():e.textContent.trim();const n=o.match(/^([+-]?[\d,]+\.?\d*)$/);if(n&&n[1]){const o=parseFloat(n[1].replace(/,/g,"")),s=p.get(e),l=s*t;if(Math.abs(o-l)>.01)if(H(o,s)){p.set(e,o);const n=o*t,s=(n<0?"-":"")+V(Math.abs(n),"margin");if(e.firstChild&&3===e.firstChild.nodeType)e.firstChild.nodeValue=s;else{const t=e.querySelector("svg");e.textContent=s,t&&e.appendChild(t)}e._mobileMarginProtectionObserver&&e._mobileMarginProtectionObserver.disconnect(),it(e,s)}else{const t=(l<0?"-":"")+V(Math.abs(l),"margin");if(e.firstChild&&3===e.firstChild.nodeType)e.firstChild.nodeValue=t;else{const o=e.querySelector("svg");e.textContent=t,o&&e.appendChild(o)}b.has(e)||it(e,t)}}}}))}catch(t){}})),['div[style*="flex: 1 0 100px"]','div[style*="flex:1 0 100px"]','div[style*="flex: 1 0 100"]','div[style*="flex:1 0 100"]','[style*="100px"][class*="text-"]','[class*="text-Sell"][style*="flex"]','[class*="text-Buy"][style*="flex"]'].forEach((e=>{try{document.querySelectorAll(e).forEach((e=>{const o=e.textContent.includes("USDT"),n=e.classList.contains("text-Sell")||e.classList.contains("text-Buy")||e.className.includes("text-Sell")||e.className.includes("text-Buy"),s=e.style.flex&&(e.style.flex.includes("100px")||e.style.flex.includes("100"));if(o&&(n||s)&&r.has(e)){const o=e.textContent.trim().match(/([+-]?[\d,]+\.?\d*)\s*USDT/i);if(o&&o[1]){const n=parseFloat(o[1].replace(/,/g,"")),s=r.get(e),l=s*t;if(Math.abs(n-l)>.01)if(H(n,s)){r.set(e,n);const o=n*t,s=e.classList.contains("text-Sell")||e.className.includes("text-Sell")||n<0?"-":"",l=V(Math.abs(o),"size"),i=`${s}${l}\nUSDT`;try{e.innerHTML=`${s}${l}<br>USDT`}catch(t){e.textContent=`${s}${l} USDT`}e._sizeProtectionObserver&&e._sizeProtectionObserver.disconnect(),ot(e,i)}else{const t=e.classList.contains("text-Sell")||e.className.includes("text-Sell")||l<0?"-":"",o=V(Math.abs(l),"size"),n=`${t}${o}\nUSDT`;try{e.innerHTML=`${t}${o}<br>USDT`}catch(n){e.textContent=`${t}${o} USDT`}x.has(e)||ot(e,n)}}}}))}catch(t){}}))}),5e3),console.log(`Ultra-Optimized PNL Modifier started successfully! (${F?"macOS":"Windows"} optimized)`),console.log("âœ¨ NEW: Real-time PNL calculation enabled! PNL will update automatically when ROI changes."),console.log("ðŸ“Š Formula: PNL = ROI Ã— Margin Ã— "+t.toLocaleString()),console.log("ðŸ”’ ROBUST: Original values stored in dataset - immune to formatting changes"),F&&setTimeout((()=>{const t=document.querySelectorAll('[style*="100px"], [class*="text-Sell"], [class*="text-Buy"]');console.log(`PNL Modifier: Found ${t.length} potential size elements on macOS`);let e=0;t.forEach((t=>{t.textContent.includes("USDT")&&(e++,console.log("PNL Modifier: Valid size element found:",{text:t.textContent.trim(),flex:t.style.flex,classes:t.className,hasUSDT:t.textContent.includes("USDT")}))})),console.log(`PNL Modifier: ${e} valid size elements with USDT found on macOS`)}),2e3),setTimeout((()=>{const t=document.querySelectorAll(".text-TextSell.t-body2");console.log(`PNL Modifier: Found ${t.length} potential mobile PNL elements`);let e=0;t.forEach((t=>{const o=t.textContent.trim();o.match(/^[+-]?[\d,]+\.?\d*$/)&&(e++,console.log("PNL Modifier: Valid mobile PNL element found:",{text:o,classes:t.className,parent:t.parentElement?t.parentElement.className:"no parent"}))})),console.log(`PNL Modifier: ${e} valid mobile PNL elements found`),F&&(console.log("PNL Modifier (macOS): Testing all mobile PNL selectors..."),k.mobilePnlElements.forEach(((t,e)=>{try{const o=document.querySelectorAll(t);console.log(`PNL Modifier (macOS): Selector ${e+1} (${t}): found ${o.length} elements`),o.forEach(((t,e)=>{const o=t.textContent.trim(),n=t.classList.contains("text-TextSell"),s=o.match(/^[+-]?[\d,]+\.?\d*$/);console.log(`  Element ${e+1}: "${o}", hasTextSell: ${n}, matchesPattern: ${!!s}`)}))}catch(e){console.warn(`PNL Modifier (macOS): Selector failed: ${t}`,e)}})));const o=document.querySelector("#POSITIONS");if(o){console.log("PNL Modifier: POSITIONS container found");const t=o.querySelectorAll(".py-\\[16px\\]");console.log(`PNL Modifier: Found ${t.length} position divs`)}else console.log("PNL Modifier: POSITIONS container NOT found")}),3e3),setTimeout((()=>{const t=document.querySelectorAll("#POSITIONS .t-body2:not(.text-TextSell)");console.log(`PNL Modifier: Found ${t.length} potential mobile size elements`);let e=0;t.forEach((t=>{const o=t.textContent.trim(),n=t.closest(".grid.grid-cols-3"),s=n?.querySelector('[class*="t-caption1"]');o.match(/^[\d,]+\.?\d*$/)&&s&&s.textContent.includes("Size")&&(e++,console.log(`Mobile Size Element: "${o}" in context: "${s.textContent}"`))})),console.log(`PNL Modifier: ${e} valid mobile size elements found`)}),4e3),setTimeout((()=>{console.log("\n=== MOBILE MARGIN DIAGNOSTIC ===");const t=document.querySelectorAll("#POSITIONS .grid.grid-cols-3 .flex.flex-col:not(.items-left):not(.items-end) .t-body2");console.log(`PNL Modifier: Found ${t.length} potential mobile margin elements`);let e=0;t.forEach((t=>{const o=3===t.firstChild?.nodeType?t.firstChild.nodeValue.trim():t.textContent.trim(),n=t.closest(".flex.flex-col"),s=n?.querySelector('[class*="t-caption1"]'),l=null!==t.querySelector("svg");o.match(/^[\d,]+\.?\d*$/)&&s&&s.textContent.includes("Margin")&&(e++,console.log(`Mobile Margin Element: "${o}" (SVG: ${l}) in context: "${s.textContent}"`))})),console.log(`PNL Modifier: ${e} valid mobile margin elements found`),console.log(`Modified margin count: ${g.size||0}`),console.log(`Tracked margin values: ${p.size}`)}),5e3),setTimeout((()=>{console.log("\n=== ROI-BASED PNL TRACKING DIAGNOSTIC ==="),console.log(`Position cards linked: ${L.size}`),console.log(`ROI elements tracked: ${T.size}`),L.forEach(((t,e)=>{const o=T.get(t.roi),n=t.roi?.textContent.trim()||"N/A",s=t.margin?.textContent.trim()||"N/A",l=t.pnl?.textContent.trim()||"N/A";console.log("Position Card:",{ROI:n,"ROI Value":void 0!==o?`${(100*o).toFixed(2)}%`:"N/A",Margin:s.substring(0,20),PNL:l.substring(0,30),"Card Visible":j(e)})})),0===L.size?(console.warn("âš ï¸ No position cards linked! ROI tracking may not be working."),console.log("Checking for position cards in DOM..."),k.positionCards.forEach((t=>{const e=document.querySelectorAll(t);console.log(`  ${t}: ${e.length} found`)}))):console.log("âœ… ROI tracking is active and will update PNL in real-time!")}),6e3)}catch(t){console.error("PNL Modifier: Error during initialization:",t)}}function yt(){let t=0;const e=setInterval((()=>{t++;try{const o=document.querySelectorAll('div[style*="flex: 1 0 140px"], div[style*="flex:1 0 140px"]').length>0,n=k.containers.some((t=>document.querySelector(t))),s=document.querySelector('div[class*="bn-"]')||document.querySelector('div[class*="binance"]')||document.body.children.length>5;(o||n||s||t>=50)&&(clearInterval(e),ht(),o||n?console.log("PNL Modifier: Started successfully after "+t+" attempts"):console.log("PNL Modifier: Started in fallback mode after "+t+" attempts"))}catch(o){console.warn("PNL Modifier: Error during startup check:",o),t>=50&&(clearInterval(e),ht())}}),F?R:150)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",yt):setTimeout(yt,F?300:100)}();